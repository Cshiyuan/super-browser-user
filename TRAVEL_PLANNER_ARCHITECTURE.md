# AI æ—…æ¸¸æ”»ç•¥è§„åˆ’åŠ©æ‰‹ - æŠ€æœ¯æ¶æ„æ–‡æ¡£

## ğŸ“‹ ç›®å½•

1. [äº§å“æ¦‚è¿°](#äº§å“æ¦‚è¿°)
2. [æ ¸å¿ƒåŠŸèƒ½](#æ ¸å¿ƒåŠŸèƒ½)
3. [æ•´ä½“æ¶æ„](#æ•´ä½“æ¶æ„)
4. [æ•°æ®æºåˆ†æ](#æ•°æ®æºåˆ†æ)
5. [æ ¸å¿ƒæ¨¡å—è®¾è®¡](#æ ¸å¿ƒæ¨¡å—è®¾è®¡)
6. [AI æ™ºèƒ½å¼•æ“](#ai-æ™ºèƒ½å¼•æ“)
7. [æ•°æ®æ¨¡å‹](#æ•°æ®æ¨¡å‹)
8. [æŠ€æœ¯æ ˆ](#æŠ€æœ¯æ ˆ)
9. [å®ç°æµç¨‹](#å®ç°æµç¨‹)
10. [å¯è¡Œæ€§åˆ†æ](#å¯è¡Œæ€§åˆ†æ)
11. [æŒ‘æˆ˜ä¸è§£å†³æ–¹æ¡ˆ](#æŒ‘æˆ˜ä¸è§£å†³æ–¹æ¡ˆ)
12. [å¼€å‘è·¯çº¿å›¾](#å¼€å‘è·¯çº¿å›¾)

---

## äº§å“æ¦‚è¿°

### äº§å“å®šä½

**AI æ—…æ¸¸æ”»ç•¥è§„åˆ’åŠ©æ‰‹** - ä»å°çº¢ä¹¦æ”¶é›†çœŸå®æ—…æ¸¸æ”»ç•¥ï¼Œç»“åˆæºç¨‹ç­‰å¹³å°çš„å®æ—¶ä»·æ ¼ä¿¡æ¯ï¼Œè‡ªåŠ¨ç”Ÿæˆå®Œæ•´çš„æ—…æ¸¸è®¡åˆ’å’Œé¢„ç®—æ–¹æ¡ˆã€‚

### æ ¸å¿ƒä»·å€¼

1. **æ”»ç•¥èšåˆ**: ä»å°çº¢ä¹¦æ”¶é›†çœŸå®ç”¨æˆ·åˆ†äº«çš„æ—…æ¸¸ä½“éªŒ
2. **ä»·æ ¼å®æ—¶**: ä»æºç¨‹/å»å“ªå„¿ç­‰å¹³å°è·å–æœ€æ–°æœºç¥¨é…’åº—ä»·æ ¼
3. **AI æ•´åˆ**: æ™ºèƒ½åˆ†ææ”»ç•¥ï¼Œæå–æ™¯ç‚¹ã€ç¾é£Ÿã€è·¯çº¿
4. **é¢„ç®—è§„åˆ’**: è‡ªåŠ¨è®¡ç®—æ€»é¢„ç®—ï¼Œæä¾›å¤šç§æ–¹æ¡ˆ
5. **ä¸€é”®ç”Ÿæˆ**: è¾“å‡ºå®Œæ•´çš„å¯æ‰§è¡Œæ—…æ¸¸è®¡åˆ’

### ä½¿ç”¨åœºæ™¯

**ç”¨æˆ·è¾“å…¥**:
```
ç›®çš„åœ°: æˆéƒ½
å‡ºå‘åœ°: åŒ—äº¬
æ—…è¡Œæ—¶é—´: 2025-05-01 ~ 2025-05-05 (5å¤©)
é¢„ç®—: 5000å…ƒ/äºº
äººæ•°: 2äºº
```

**ç³»ç»Ÿè¾“å‡º**:
```
ğŸ“‹ æˆéƒ½5æ—¥æ¸¸å®Œæ•´æ”»ç•¥

âœˆï¸ äº¤é€šæ–¹æ¡ˆ
- å»ç¨‹: 2025-05-01 åŒ—äº¬â†’æˆéƒ½ CA1234 Â¥650/äºº
- è¿”ç¨‹: 2025-05-05 æˆéƒ½â†’åŒ—äº¬ CA5678 Â¥680/äºº

ğŸ¨ ä½å®¿æ–¹æ¡ˆ
- 5æœˆ1-2æ—¥: æ˜¥ç†™è·¯é™„è¿‘æ°‘å®¿ Â¥280/æ™š
- 5æœˆ3-4æ—¥: å®½çª„å··å­é…’åº— Â¥350/æ™š

ğŸ“ è¡Œç¨‹å®‰æ’
Day 1: å®½çª„å··å­ â†’ é”¦é‡Œ â†’ æ˜¥ç†™è·¯
Day 2: ç†ŠçŒ«åŸºåœ° â†’ å¤ªå¤é‡Œ â†’ ä¹çœ¼æ¡¥é…’å§è¡—
Day 3: éƒ½æ±Ÿå ° â†’ é’åŸå±±
Day 4: æ­¦ä¾¯ç¥  â†’ äººæ°‘å…¬å›­ â†’ å»ºè®¾è·¯ç¾é£Ÿè¡—
Day 5: æˆéƒ½åšç‰©é¦† â†’ è¿”ç¨‹

ğŸœ ç¾é£Ÿæ¨è
- ç«é”…: å°é¾™åã€å¤§é¾™ç‡š (äººå‡Â¥100)
- å·èœ: é©¬æ—ºå­ã€æˆéƒ½åƒå®¢ (äººå‡Â¥80)
- å°åƒ: é’Ÿæ°´é¥ºã€éŸ©åŒ…å­ (äººå‡Â¥30)

ğŸ’° é¢„ç®—æ˜ç»†
äº¤é€š: Â¥2,660 (2äººå¾€è¿”æœºç¥¨)
ä½å®¿: Â¥2,520 (4æ™š Ã— 2äºº)
é¤é¥®: Â¥1,200 (5å¤© Ã— 2äºº Ã— Â¥120/å¤©)
é—¨ç¥¨: Â¥500 (ç†ŠçŒ«åŸºåœ°ã€éƒ½æ±Ÿå °ç­‰)
å…¶ä»–: Â¥500 (äº¤é€šã€è´­ç‰©ç­‰)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
æ€»è®¡: Â¥7,380 (ç•¥è¶…é¢„ç®—)

ğŸ’¡ çœé’±å»ºè®®:
1. æå‰15å¤©è®¢ç¥¨å¯çœÂ¥200
2. é€‰æ‹©å¿«æ·é…’åº—å¯çœÂ¥600
3. ä¼˜åŒ–åæ€»é¢„ç®—: Â¥6,580
```

---

## æ ¸å¿ƒåŠŸèƒ½

### åŠŸèƒ½æ¨¡å—å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç”¨æˆ·è¾“å…¥å±‚                           â”‚
â”‚  ç›®çš„åœ° | æ—¶é—´ | é¢„ç®— | åå¥½                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 æ•°æ®æ”¶é›†å±‚ï¼ˆå¹¶è¡Œï¼‰                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚å°çº¢ä¹¦æ”»ç•¥â”‚  â”‚æºç¨‹æœºç¥¨  â”‚  â”‚æºç¨‹é…’åº—  â”‚  â”‚å»å“ªå„¿  â”‚â”‚
â”‚  â”‚æ™¯ç‚¹ç¾é£Ÿ  â”‚  â”‚å®æ—¶ä»·æ ¼  â”‚  â”‚å®æ—¶ä»·æ ¼  â”‚  â”‚ä»·æ ¼å¯¹æ¯”â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   AI åˆ†æå±‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Gemini AI å¤šæ¨¡æ€åˆ†æ                            â”‚  â”‚
â”‚  â”‚  - æå–æ”»ç•¥ä¸­çš„æ™¯ç‚¹ã€ç¾é£Ÿã€è·¯çº¿                 â”‚  â”‚
â”‚  â”‚  - åˆ†æå›¾ç‰‡ä¸­çš„åœºæ™¯å’Œä½“éªŒ                       â”‚  â”‚
â”‚  â”‚  - ç†è§£ç”¨æˆ·åå¥½å’Œè¯„ä»·                           â”‚  â”‚
â”‚  â”‚  - ç”Ÿæˆåˆç†çš„è¡Œç¨‹å®‰æ’                           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  è§„åˆ’ç”Ÿæˆå±‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚è¡Œç¨‹è§„åˆ’  â”‚  â”‚é¢„ç®—è®¡ç®—  â”‚  â”‚æ–¹æ¡ˆä¼˜åŒ–  â”‚  â”‚æŠ¥å‘Šç”Ÿæˆâ”‚â”‚
â”‚  â”‚è·¯çº¿ä¼˜åŒ–  â”‚  â”‚ä»·æ ¼æ±‡æ€»  â”‚  â”‚å¤šæ–¹æ¡ˆ    â”‚  â”‚PDF/HTMLâ”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   è¾“å‡ºå±‚                                 â”‚
â”‚  å®Œæ•´æ—…æ¸¸è®¡åˆ’ | é¢„ç®—æ˜ç»† | é¢„è®¢é“¾æ¥ | æ³¨æ„äº‹é¡¹         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒåŠŸèƒ½åˆ—è¡¨

#### 1. æ™ºèƒ½æ”»ç•¥æ”¶é›† â­â­â­â­â­
- ä»å°çº¢ä¹¦æ”¶é›†ç›®çš„åœ°ç›¸å…³æ”»ç•¥
- æå–æ™¯ç‚¹ã€ç¾é£Ÿã€ä½å®¿ã€è·¯çº¿ä¿¡æ¯
- åˆ†æç”¨æˆ·è¯„ä»·å’Œæ¨èåº¦
- å›¾ç‰‡è¯†åˆ«ï¼ˆæ™¯ç‚¹ã€ç¾é£Ÿç…§ç‰‡ï¼‰

#### 2. å®æ—¶ä»·æ ¼æŸ¥è¯¢ â­â­â­â­â­
- æºç¨‹æœºç¥¨æŸ¥è¯¢ï¼ˆå‡ºå‘åœ°â†’ç›®çš„åœ°ï¼‰
- æºç¨‹é…’åº—æŸ¥è¯¢ï¼ˆä½ç½®ã€ä»·æ ¼ã€è¯„åˆ†ï¼‰
- å»å“ªå„¿ä»·æ ¼å¯¹æ¯”
- ä»·æ ¼è¶‹åŠ¿é¢„æµ‹

#### 3. AI è¡Œç¨‹è§„åˆ’ â­â­â­â­â­
- æ ¹æ®å¤©æ•°æ™ºèƒ½å®‰æ’è¡Œç¨‹
- æ™¯ç‚¹è·¯çº¿ä¼˜åŒ–ï¼ˆå‡å°‘é€šå‹¤æ—¶é—´ï¼‰
- æ—¶é—´åˆ†é…åˆç†åŒ–
- è€ƒè™‘æ™¯ç‚¹å¼€æ”¾æ—¶é—´ã€æ’é˜Ÿæƒ…å†µ

#### 4. é¢„ç®—è®¡ç®— â­â­â­â­â­
- äº¤é€šè´¹ç”¨ï¼ˆæœºç¥¨ã€é«˜é“ã€å½“åœ°äº¤é€šï¼‰
- ä½å®¿è´¹ç”¨ï¼ˆå¤šç§æ¡£æ¬¡å¯é€‰ï¼‰
- é¤é¥®é¢„ç®—ï¼ˆæ ¹æ®æ”»ç•¥äººå‡æ¶ˆè´¹ï¼‰
- é—¨ç¥¨åŠå…¶ä»–è´¹ç”¨
- æ€»é¢„ç®—æ§åˆ¶å’Œä¼˜åŒ–å»ºè®®

#### 5. å¤šæ–¹æ¡ˆç”Ÿæˆ â­â­â­â­
- ç»æµæ–¹æ¡ˆï¼ˆé¢„ç®—ä¼˜å…ˆï¼‰
- èˆ’é€‚æ–¹æ¡ˆï¼ˆä½“éªŒä¼˜å…ˆï¼‰
- å¹³è¡¡æ–¹æ¡ˆï¼ˆæ€§ä»·æ¯”ï¼‰
- è‡ªå®šä¹‰æ–¹æ¡ˆ

#### 6. æŠ¥å‘Šç”Ÿæˆ â­â­â­â­
- å®Œæ•´æ”»ç•¥ PDF/HTML
- é¢„ç®—æ˜ç»†è¡¨æ ¼
- é¢„è®¢é“¾æ¥ä¸€é”®è·³è½¬
- åœ°å›¾å¯¼èˆªé›†æˆ

---

## æ•´ä½“æ¶æ„

### ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         å‰ç«¯å±‚                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ Web UI  â”‚  â”‚  å°ç¨‹åº â”‚  â”‚   APP   â”‚  â”‚   CLI   â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       API ç½‘å…³å±‚                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  FastAPI + GraphQL                                    â”‚  â”‚
â”‚  â”‚  - è¯·æ±‚è·¯ç”±  - å‚æ•°éªŒè¯  - é™æµæ§åˆ¶                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ä¸šåŠ¡ç¼–æ’å±‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  è§„åˆ’ç¼–æ’å™¨ (Orchestrator)                           â”‚  â”‚
â”‚  â”‚  - ä»»åŠ¡è°ƒåº¦  - å¹¶è¡Œæ‰§è¡Œ  - ç»“æœèšåˆ                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ ¸å¿ƒæœåŠ¡å±‚ï¼ˆå¾®æœåŠ¡ï¼‰                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚æ”»ç•¥æ”¶é›†  â”‚  â”‚ä»·æ ¼æŸ¥è¯¢  â”‚  â”‚AI åˆ†æ   â”‚  â”‚è§„åˆ’ç”Ÿæˆ  â”‚   â”‚
â”‚  â”‚æœåŠ¡      â”‚  â”‚æœåŠ¡      â”‚  â”‚æœåŠ¡      â”‚  â”‚æœåŠ¡      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æ•°æ®é‡‡é›†å±‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚browser-  â”‚  â”‚æºç¨‹ API/ â”‚  â”‚å»å“ªå„¿    â”‚  â”‚é«˜å¾·åœ°å›¾  â”‚   â”‚
â”‚  â”‚use       â”‚  â”‚çˆ¬è™«      â”‚  â”‚çˆ¬è™«      â”‚  â”‚API       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æ•°æ®å­˜å‚¨å±‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚PostgreSQLâ”‚  â”‚  Redis   â”‚  â”‚  S3/OSS  â”‚  â”‚Vector DB â”‚   â”‚
â”‚  â”‚å…³ç³»æ•°æ®  â”‚  â”‚  ç¼“å­˜    â”‚  â”‚  å›¾ç‰‡    â”‚  â”‚æ”»ç•¥å‘é‡  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æŠ€æœ¯æ¶æ„åˆ†å±‚

| å±‚æ¬¡ | èŒè´£ | æŠ€æœ¯é€‰å‹ |
|-----|------|---------|
| **å‰ç«¯å±‚** | ç”¨æˆ·äº¤äº’ | React/Vue + å¾®ä¿¡å°ç¨‹åº + Flutter APP |
| **APIå±‚** | æ¥å£æœåŠ¡ | FastAPI + GraphQL |
| **ç¼–æ’å±‚** | ä»»åŠ¡è°ƒåº¦ | Celery + Redis |
| **æœåŠ¡å±‚** | ä¸šåŠ¡é€»è¾‘ | Python å¾®æœåŠ¡ |
| **é‡‡é›†å±‚** | æ•°æ®è·å– | browser-use + API + çˆ¬è™« |
| **å­˜å‚¨å±‚** | æ•°æ®æŒä¹…åŒ– | PostgreSQL + Redis + OSS + Qdrant |

---

## æ•°æ®æºåˆ†æ

### 1. å°çº¢ä¹¦ï¼ˆæ”»ç•¥æ¥æºï¼‰â­â­â­â­â­

**å¯è·å–æ•°æ®**:
- âœ… æ—…æ¸¸æ”»ç•¥å¸–å­ï¼ˆæ ‡é¢˜ã€æ­£æ–‡ã€å›¾ç‰‡ï¼‰
- âœ… æ™¯ç‚¹æ¨èï¼ˆä½ç½®ã€ç‰¹è‰²ã€é—¨ç¥¨ï¼‰
- âœ… ç¾é£Ÿæ¨èï¼ˆé¤å…åã€äººå‡æ¶ˆè´¹ã€èœå“ï¼‰
- âœ… ä½å®¿ä½“éªŒï¼ˆé…’åº—/æ°‘å®¿ã€ä»·æ ¼ã€è¯„ä»·ï¼‰
- âœ… è·¯çº¿å®‰æ’ï¼ˆè¡Œç¨‹è§„åˆ’ã€æ—¶é—´åˆ†é…ï¼‰
- âœ… æ³¨æ„äº‹é¡¹ï¼ˆå¤©æ°”ã€ç©¿æ­ã€é¿å‘ï¼‰

**å®ç°æ–¹å¼**:
```python
# å¤ç”¨ç°æœ‰çš„ xiaohongshu_collector.py
class TravelGuideCollector(XiaohongshuCollectorOptimized):
    """æ—…æ¸¸æ”»ç•¥æ”¶é›†å™¨"""

    async def collect_destination_guides(
        self,
        destination: str,
        max_posts: int = 20
    ) -> List[TravelGuide]:
        """æ”¶é›†ç›®çš„åœ°æ”»ç•¥"""

        # 1. æœç´¢å…³é”®è¯
        keywords = [
            f"{destination}æ—…æ¸¸æ”»ç•¥",
            f"{destination}è‡ªç”±è¡Œ",
            f"{destination}æ™¯ç‚¹æ¨è",
            f"{destination}ç¾é£Ÿæ”»ç•¥"
        ]

        guides = []
        for keyword in keywords:
            # 2. æ”¶é›†å¸–å­
            search_url = f"https://www.xiaohongshu.com/search_result?keyword={keyword}"
            posts = await self.collect_posts_from_search(search_url, max_posts)

            # 3. æå–æ”»ç•¥ä¿¡æ¯
            for post in posts:
                guide = self.extract_guide_info(post)
                guides.append(guide)

        return guides

    def extract_guide_info(self, post: Post) -> TravelGuide:
        """ä»å¸–å­æå–æ”»ç•¥ä¿¡æ¯ï¼ˆä½¿ç”¨ AIï¼‰"""

        prompt = f"""
        åˆ†æè¿™ç¯‡å°çº¢ä¹¦æ—…æ¸¸æ”»ç•¥ï¼Œæå–ä»¥ä¸‹ä¿¡æ¯ï¼š

        æ ‡é¢˜: {post.title}
        å†…å®¹: {post.content}

        è¯·æå–ï¼š
        1. æ™¯ç‚¹åˆ—è¡¨ï¼ˆåç§°ã€æ¨èç†ç”±ã€é—¨ç¥¨ã€å¼€æ”¾æ—¶é—´ï¼‰
        2. ç¾é£Ÿæ¨èï¼ˆé¤å…ã€èœå“ã€äººå‡æ¶ˆè´¹ï¼‰
        3. ä½å®¿ä¿¡æ¯ï¼ˆç±»å‹ã€ä½ç½®ã€ä»·æ ¼ï¼‰
        4. è¡Œç¨‹å®‰æ’ï¼ˆå¤©æ•°ã€è·¯çº¿ï¼‰
        5. æ³¨æ„äº‹é¡¹ï¼ˆäº¤é€šã€å¤©æ°”ã€é¿å‘ï¼‰

        è¿”å› JSON æ ¼å¼
        """

        # AI æå–
        result = gemini.generate(prompt)
        return TravelGuide(**result)
```

**æŠ€æœ¯å¯è¡Œæ€§**: âœ… å®Œå…¨å¯è¡Œï¼ˆå·²æœ‰å®Œæ•´å®ç°ï¼‰

---

### 2. æºç¨‹ï¼ˆæœºç¥¨/é…’åº—ï¼‰â­â­â­â­

**å¯è·å–æ•°æ®**:
- âœ… æœºç¥¨ä¿¡æ¯ï¼ˆèˆªç­å·ã€æ—¶é—´ã€ä»·æ ¼ã€èˆ±ä½ï¼‰
- âœ… é…’åº—ä¿¡æ¯ï¼ˆåç§°ã€ä½ç½®ã€ä»·æ ¼ã€è¯„åˆ†ã€è®¾æ–½ï¼‰
- âš ï¸ éœ€è¦å¤„ç†åçˆ¬è™«

**å®ç°æ–¹å¼**:

#### æ–¹å¼1: å®˜æ–¹ APIï¼ˆæ¨èï¼‰â­â­â­â­â­
```python
# æºç¨‹æœ‰å¼€æ”¾ APIï¼ˆéœ€è¦ç”³è¯·ï¼‰
# https://open.ctrip.com/

class CtripAPIClient:
    """æºç¨‹ API å®¢æˆ·ç«¯"""

    def __init__(self, api_key: str, api_secret: str):
        self.api_key = api_key
        self.api_secret = api_secret
        self.base_url = "https://api.ctrip.com/v1"

    async def search_flights(
        self,
        from_city: str,
        to_city: str,
        date: str
    ) -> List[Flight]:
        """æœç´¢æœºç¥¨"""

        url = f"{self.base_url}/flights/search"
        params = {
            "from": from_city,
            "to": to_city,
            "date": date,
            "api_key": self.api_key
        }

        # ç­¾å
        signature = self._generate_signature(params)
        params["signature"] = signature

        # è¯·æ±‚
        async with httpx.AsyncClient() as client:
            resp = await client.get(url, params=params)
            data = resp.json()

        return [Flight(**item) for item in data["flights"]]

    async def search_hotels(
        self,
        city: str,
        checkin: str,
        checkout: str
    ) -> List[Hotel]:
        """æœç´¢é…’åº—"""
        # ç±»ä¼¼å®ç°
        pass
```

**ä¼˜ç‚¹**:
- âœ… ç¨³å®šå¯é 
- âœ… æ•°æ®å‡†ç¡®
- âœ… æ— åçˆ¬è™«é—®é¢˜

**ç¼ºç‚¹**:
- âŒ éœ€è¦ä¼ä¸šè®¤è¯
- âŒ å¯èƒ½æœ‰è°ƒç”¨é™åˆ¶

#### æ–¹å¼2: æµè§ˆå™¨è‡ªåŠ¨åŒ–ï¼ˆå¤‡ç”¨ï¼‰â­â­â­
```python
class CtripScraper:
    """æºç¨‹çˆ¬è™«ï¼ˆbrowser-useï¼‰"""

    async def search_flights_by_browser(
        self,
        from_city: str,
        to_city: str,
        date: str
    ) -> List[Flight]:
        """é€šè¿‡æµè§ˆå™¨æœç´¢æœºç¥¨"""

        # 1. è®¿é—®æºç¨‹æœºç¥¨æœç´¢é¡µ
        url = f"https://flights.ctrip.com/..."

        # 2. ä½¿ç”¨ browser-use Agent
        agent = Agent(
            task=f"""
            è®¿é—® {url}
            å¡«å†™ï¼š
            - å‡ºå‘åœ°: {from_city}
            - ç›®çš„åœ°: {to_city}
            - æ—¥æœŸ: {date}

            ç‚¹å‡»æœç´¢ï¼Œä½¿ç”¨ extract_structured_data æ”¶é›†ï¼š
            - èˆªç­å·
            - èµ·é£/åˆ°è¾¾æ—¶é—´
            - ä»·æ ¼
            - èˆªç©ºå…¬å¸
            - èˆ±ä½
            è¿”å› JSON æ•°ç»„
            """,
            llm=self.llm,
            browser_context=self.context
        )

        result = await agent.run()
        flights = self.extract_flights(result)
        return flights
```

**ä¼˜ç‚¹**:
- âœ… æ— éœ€ API å¯†é’¥
- âœ… çµæ´»æ€§é«˜

**ç¼ºç‚¹**:
- âŒ å¯èƒ½è¢«åçˆ¬è™«é™åˆ¶
- âŒ ä¸å¤Ÿç¨³å®š

#### æ¨èæ–¹æ¡ˆ: API ä¼˜å…ˆï¼Œæµè§ˆå™¨å¤‡ç”¨

```python
class FlightSearchService:
    """æœºç¥¨æœç´¢æœåŠ¡ï¼ˆæ··åˆæ¨¡å¼ï¼‰"""

    def __init__(self):
        self.api_client = CtripAPIClient(...)
        self.scraper = CtripScraper(...)

    async def search_flights(self, from_city, to_city, date):
        try:
            # ä¼˜å…ˆä½¿ç”¨ API
            return await self.api_client.search_flights(...)
        except Exception as e:
            # API å¤±è´¥ï¼Œé™çº§åˆ°æµè§ˆå™¨
            logger.warning(f"API failed: {e}, fallback to browser")
            return await self.scraper.search_flights_by_browser(...)
```

**æŠ€æœ¯å¯è¡Œæ€§**: âœ… å¯è¡Œï¼ˆAPI æˆ– æµè§ˆå™¨è‡ªåŠ¨åŒ–ï¼‰

---

### 3. å»å“ªå„¿ï¼ˆä»·æ ¼å¯¹æ¯”ï¼‰â­â­â­

**å¯è·å–æ•°æ®**:
- âœ… æœºç¥¨æ¯”ä»·
- âœ… é…’åº—æ¯”ä»·

**å®ç°æ–¹å¼**: åŒæºç¨‹ï¼ˆAPI æˆ– browser-useï¼‰

**æŠ€æœ¯å¯è¡Œæ€§**: âœ… å¯è¡Œ

---

### 4. é«˜å¾·åœ°å›¾ï¼ˆè·¯çº¿è§„åˆ’ï¼‰â­â­â­â­â­

**å¯è·å–æ•°æ®**:
- âœ… æ™¯ç‚¹ä½ç½®ï¼ˆç»çº¬åº¦ï¼‰
- âœ… è·¯çº¿è§„åˆ’ï¼ˆæ­¥è¡Œ/é©¾è½¦/å…¬äº¤ï¼‰
- âœ… è·ç¦»å’Œè€—æ—¶
- âœ… å‘¨è¾¹æŸ¥è¯¢ï¼ˆé¤å…ã€é…’åº—ï¼‰

**å®ç°æ–¹å¼**: å®˜æ–¹ API

```python
class AmapAPIClient:
    """é«˜å¾·åœ°å›¾ API"""

    async def geocode(self, address: str) -> Location:
        """åœ°å€è½¬åæ ‡"""
        url = "https://restapi.amap.com/v3/geocode/geo"
        params = {
            "address": address,
            "key": self.api_key
        }
        # ...

    async def route_planning(
        self,
        origin: Location,
        destination: Location,
        mode: str = "walking"  # walking/driving/transit
    ) -> Route:
        """è·¯çº¿è§„åˆ’"""
        url = "https://restapi.amap.com/v3/direction/{mode}"
        # ...

    async def nearby_search(
        self,
        location: Location,
        keywords: str,  # "é¤å…" | "é…’åº—"
        radius: int = 1000
    ) -> List[POI]:
        """å‘¨è¾¹æœç´¢"""
        # ...
```

**æŠ€æœ¯å¯è¡Œæ€§**: âœ… å®Œå…¨å¯è¡Œï¼ˆå®˜æ–¹ API ç¨³å®šï¼‰

---

## æ ¸å¿ƒæ¨¡å—è®¾è®¡

### 1. æ”»ç•¥æ”¶é›†æ¨¡å— (Guide Collector)

**èŒè´£**: ä»å°çº¢ä¹¦æ”¶é›†å¹¶åˆ†ææ—…æ¸¸æ”»ç•¥

```python
class GuideCollectorService:
    """æ”»ç•¥æ”¶é›†æœåŠ¡"""

    async def collect_and_analyze(
        self,
        destination: str,
        days: int
    ) -> DestinationGuide:
        """æ”¶é›†å¹¶åˆ†æç›®çš„åœ°æ”»ç•¥"""

        # 1. æ”¶é›†æ”»ç•¥å¸–å­
        posts = await self.collect_guides(destination, max_posts=30)

        # 2. AI æå–ç»“æ„åŒ–ä¿¡æ¯
        attractions = []
        restaurants = []
        routes = []

        for post in posts:
            # å¹¶å‘æå–
            extracted = await self.ai_extract(post)
            attractions.extend(extracted.attractions)
            restaurants.extend(extracted.restaurants)
            routes.extend(extracted.routes)

        # 3. å»é‡å’Œèšåˆ
        attractions = self.deduplicate_attractions(attractions)
        restaurants = self.deduplicate_restaurants(restaurants)

        # 4. è¯„åˆ†æ’åº
        attractions = self.rank_by_popularity(attractions)
        restaurants = self.rank_by_popularity(restaurants)

        return DestinationGuide(
            destination=destination,
            attractions=attractions[:20],  # Top 20
            restaurants=restaurants[:30],  # Top 30
            sample_routes=routes[:5]
        )

    async def ai_extract(self, post: Post) -> ExtractedInfo:
        """AI æå–æ”»ç•¥ä¿¡æ¯"""

        # å¤šæ¨¡æ€åˆ†æï¼ˆæ–‡å­— + å›¾ç‰‡ï¼‰
        prompt = f"""
        åˆ†æè¿™ç¯‡æ—…æ¸¸æ”»ç•¥ï¼š

        æ ‡é¢˜: {post.title}
        å†…å®¹: {post.content}
        å›¾ç‰‡: {len(post.images)}å¼ 

        æå–ï¼š
        1. æ™¯ç‚¹ä¿¡æ¯
        {{
          "name": "æ™¯ç‚¹å",
          "location": "å…·ä½“ä½ç½®",
          "ticket_price": "é—¨ç¥¨ä»·æ ¼",
          "visit_duration": "å»ºè®®æ¸¸ç©æ—¶é—´",
          "highlights": ["äº®ç‚¹1", "äº®ç‚¹2"],
          "tips": ["æ³¨æ„äº‹é¡¹1", ...]
        }}

        2. é¤å…ä¿¡æ¯
        {{
          "name": "é¤å…å",
          "cuisine": "èœç³»",
          "average_cost": äººå‡æ¶ˆè´¹,
          "recommended_dishes": ["èœå“1", ...],
          "location": "ä½ç½®"
        }}

        3. è·¯çº¿ä¿¡æ¯
        {{
          "day": å¤©æ•°,
          "route": ["åœ°ç‚¹1", "åœ°ç‚¹2", ...],
          "notes": "æ³¨æ„äº‹é¡¹"
        }}

        è¿”å› JSON
        """

        result = await self.gemini.generate(
            prompt,
            images=post.images  # Gemini æ”¯æŒå¤šæ¨¡æ€
        )

        return ExtractedInfo(**result)

    def deduplicate_attractions(self, attractions: List[Attraction]) -> List[Attraction]:
        """æ™¯ç‚¹å»é‡ï¼ˆåŸºäºåç§°ç›¸ä¼¼åº¦ï¼‰"""

        from difflib import SequenceMatcher

        unique = []
        for attr in attractions:
            # æ£€æŸ¥æ˜¯å¦ä¸å·²æœ‰æ™¯ç‚¹é‡å¤
            is_duplicate = False
            for existing in unique:
                similarity = SequenceMatcher(
                    None,
                    attr.name,
                    existing.name
                ).ratio()

                if similarity > 0.8:  # 80% ç›¸ä¼¼è§†ä¸ºé‡å¤
                    # åˆå¹¶ä¿¡æ¯ï¼ˆä¿ç•™æ›´è¯¦ç»†çš„ï¼‰
                    existing.merge(attr)
                    is_duplicate = True
                    break

            if not is_duplicate:
                unique.append(attr)

        return unique

    def rank_by_popularity(self, items: List) -> List:
        """æŒ‰çƒ­åº¦æ’åº"""

        # çƒ­åº¦ = æåŠæ¬¡æ•° * å¹³å‡è¯„åˆ†
        for item in items:
            item.popularity_score = item.mention_count * item.avg_rating

        return sorted(items, key=lambda x: x.popularity_score, reverse=True)
```

---

### 2. ä»·æ ¼æŸ¥è¯¢æ¨¡å— (Price Query Service)

**èŒè´£**: æŸ¥è¯¢æœºç¥¨ã€é…’åº—ç­‰å®æ—¶ä»·æ ¼

```python
class PriceQueryService:
    """ä»·æ ¼æŸ¥è¯¢æœåŠ¡"""

    def __init__(self):
        self.ctrip = CtripAPIClient(...)
        self.qunar = QunarAPIClient(...)
        self.cache = RedisCache(...)

    async def search_flights(
        self,
        from_city: str,
        to_city: str,
        date: str,
        return_date: Optional[str] = None
    ) -> FlightSearchResult:
        """æœç´¢æœºç¥¨ï¼ˆå¾€è¿”ï¼‰"""

        # 1. æ£€æŸ¥ç¼“å­˜
        cache_key = f"flight:{from_city}:{to_city}:{date}"
        cached = await self.cache.get(cache_key)
        if cached:
            return cached

        # 2. å¹¶å‘æŸ¥è¯¢å¤šä¸ªå¹³å°
        tasks = [
            self.ctrip.search_flights(from_city, to_city, date),
            self.qunar.search_flights(from_city, to_city, date)
        ]

        results = await asyncio.gather(*tasks, return_exceptions=True)

        # 3. èšåˆç»“æœ
        all_flights = []
        for result in results:
            if isinstance(result, Exception):
                logger.error(f"Query failed: {result}")
                continue
            all_flights.extend(result)

        # 4. å»é‡ï¼ˆç›¸åŒèˆªç­å·ï¼‰
        unique_flights = self.deduplicate_flights(all_flights)

        # 5. æ’åºï¼ˆä»·æ ¼ä¼˜å…ˆï¼‰
        sorted_flights = sorted(unique_flights, key=lambda f: f.price)

        # 6. ç¼“å­˜ç»“æœï¼ˆ1å°æ—¶ï¼‰
        result = FlightSearchResult(flights=sorted_flights[:20])
        await self.cache.set(cache_key, result, ttl=3600)

        return result

    async def search_hotels(
        self,
        city: str,
        location: str,  # "å¸‚ä¸­å¿ƒ" | "æ™¯åŒºé™„è¿‘"
        checkin: str,
        checkout: str,
        budget: Optional[int] = None
    ) -> HotelSearchResult:
        """æœç´¢é…’åº—"""

        # 1. è·å–ä½ç½®åæ ‡ï¼ˆé«˜å¾·åœ°å›¾ï¼‰
        coords = await self.amap.geocode(f"{city}{location}")

        # 2. å¹¶å‘æŸ¥è¯¢
        tasks = [
            self.ctrip.search_hotels(coords, checkin, checkout),
            self.qunar.search_hotels(coords, checkin, checkout)
        ]

        results = await asyncio.gather(*tasks, return_exceptions=True)

        # 3. èšåˆå’Œå»é‡
        all_hotels = []
        for result in results:
            if not isinstance(result, Exception):
                all_hotels.extend(result)

        unique_hotels = self.deduplicate_hotels(all_hotels)

        # 4. ä»·æ ¼è¿‡æ»¤
        if budget:
            unique_hotels = [h for h in unique_hotels if h.price <= budget]

        # 5. æ’åºï¼ˆè¯„åˆ† Ã— æ€§ä»·æ¯”ï¼‰
        sorted_hotels = sorted(
            unique_hotels,
            key=lambda h: h.rating * (1000 / h.price),  # æ€§ä»·æ¯”æŒ‡æ•°
            reverse=True
        )

        return HotelSearchResult(hotels=sorted_hotels[:30])
```

---

### 3. AI è§„åˆ’å¼•æ“ (Planning Engine)

**èŒè´£**: æ™ºèƒ½ç”Ÿæˆæ—…æ¸¸è¡Œç¨‹å’Œé¢„ç®—æ–¹æ¡ˆ

```python
class TravelPlanningEngine:
    """æ—…æ¸¸è§„åˆ’å¼•æ“"""

    async def generate_plan(
        self,
        request: PlanRequest
    ) -> TravelPlan:
        """ç”Ÿæˆæ—…æ¸¸è®¡åˆ’"""

        # 1. æ”¶é›†æ•°æ®
        guide = await self.guide_collector.collect_and_analyze(
            request.destination,
            request.days
        )

        flights = await self.price_service.search_flights(
            request.from_city,
            request.destination,
            request.start_date,
            request.end_date
        )

        hotels = await self.price_service.search_hotels(
            request.destination,
            "å¸‚ä¸­å¿ƒ",
            request.start_date,
            request.end_date,
            budget=request.budget_per_night
        )

        # 2. AI ç”Ÿæˆè¡Œç¨‹
        itinerary = await self.ai_generate_itinerary(
            guide=guide,
            days=request.days,
            preferences=request.preferences
        )

        # 3. è®¡ç®—é¢„ç®—
        budget = self.calculate_budget(
            flights=flights.flights[0],  # æœ€ä¼˜èˆªç­
            hotels=hotels.hotels[0],     # æœ€ä¼˜é…’åº—
            itinerary=itinerary,
            num_people=request.num_people,
            days=request.days
        )

        # 4. ä¼˜åŒ–æ–¹æ¡ˆ
        if budget.total > request.total_budget:
            # é¢„ç®—è¶…äº†ï¼Œä¼˜åŒ–
            optimized = await self.optimize_budget(
                flights, hotels, itinerary,
                target_budget=request.total_budget
            )
            return optimized

        # 5. ç”Ÿæˆæœ€ç»ˆè®¡åˆ’
        return TravelPlan(
            destination=request.destination,
            flights=flights.flights[0],
            hotels=hotels.hotels[0],
            itinerary=itinerary,
            budget=budget,
            tips=guide.tips
        )

    async def ai_generate_itinerary(
        self,
        guide: DestinationGuide,
        days: int,
        preferences: UserPreferences
    ) -> Itinerary:
        """AI ç”Ÿæˆè¡Œç¨‹"""

        # æ„å»ºæç¤ºè¯
        prompt = f"""
        ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æ—…æ¸¸è§„åˆ’å¸ˆï¼Œè¯·æ ¹æ®ä»¥ä¸‹ä¿¡æ¯ç”Ÿæˆ {days} å¤©çš„æ—…æ¸¸è¡Œç¨‹ï¼š

        ç›®çš„åœ°: {guide.destination}

        çƒ­é—¨æ™¯ç‚¹ Top 10:
        {json.dumps([{"name": a.name, "äº®ç‚¹": a.highlights, "æ¸¸ç©æ—¶é•¿": a.visit_duration} for a in guide.attractions[:10]], ensure_ascii=False, indent=2)}

        çƒ­é—¨é¤å… Top 10:
        {json.dumps([{"name": r.name, "èœç³»": r.cuisine, "äººå‡": r.average_cost} for r in guide.restaurants[:10]], ensure_ascii=False, indent=2)}

        ç”¨æˆ·åå¥½:
        - å…´è¶£: {preferences.interests}  # ["è‡ªç„¶é£å…‰", "å†å²æ–‡åŒ–", "ç¾é£Ÿ"]
        - èŠ‚å¥: {preferences.pace}       # "relaxed" | "moderate" | "fast"
        - é¢„ç®—: {preferences.budget}     # "budget" | "moderate" | "luxury"

        è¦æ±‚ï¼š
        1. åˆç†å®‰æ’æ¯å¤©è¡Œç¨‹ï¼ˆä¸Šåˆã€ä¸‹åˆã€æ™šä¸Šï¼‰
        2. è€ƒè™‘æ™¯ç‚¹å¼€æ”¾æ—¶é—´å’Œåœ°ç†ä½ç½®ï¼ˆå‡å°‘é€šå‹¤ï¼‰
        3. å¹³è¡¡è§‚å…‰å’Œä¼‘é—²ï¼ˆé¿å…è¿‡åº¦ç–²åŠ³ï¼‰
        4. æ¨èæ¯é¤çš„é¤å…
        5. ç»™å‡ºæ¯ä¸ªæ™¯ç‚¹çš„é¢„è®¡æ¸¸ç©æ—¶é—´

        è¿”å› JSON æ ¼å¼ï¼š
        {{
          "days": [
            {{
              "day": 1,
              "morning": {{
                "attraction": "æ™¯ç‚¹å",
                "duration": "2å°æ—¶",
                "highlights": ["äº®ç‚¹1", "äº®ç‚¹2"],
                "tips": "æ³¨æ„äº‹é¡¹"
              }},
              "lunch": {{
                "restaurant": "é¤å…å",
                "cuisine": "èœç³»",
                "average_cost": 80
              }},
              "afternoon": {{...}},
              "dinner": {{...}},
              "notes": "ä»Šæ—¥æ€»ç»“"
            }},
            ...
          ]
        }}
        """

        # AI ç”Ÿæˆ
        result = await self.gemini.generate(prompt)
        itinerary = Itinerary(**result)

        # ä¼˜åŒ–è·¯çº¿ï¼ˆå‡å°‘é€šå‹¤æ—¶é—´ï¼‰
        itinerary = await self.optimize_route(itinerary)

        return itinerary

    async def optimize_route(self, itinerary: Itinerary) -> Itinerary:
        """ä¼˜åŒ–è·¯çº¿ï¼ˆå‡å°‘é€šå‹¤æ—¶é—´ï¼‰"""

        for day in itinerary.days:
            # è·å–å½“å¤©æ‰€æœ‰æ™¯ç‚¹çš„åæ ‡
            attractions = [
                day.morning.attraction if day.morning else None,
                day.afternoon.attraction if day.afternoon else None,
                day.evening.attraction if day.evening else None
            ]
            attractions = [a for a in attractions if a]

            # è·å–åæ ‡
            locations = []
            for attr_name in attractions:
                loc = await self.amap.geocode(attr_name)
                locations.append(loc)

            # ä½¿ç”¨ TSP ç®—æ³•ä¼˜åŒ–é¡ºåºï¼ˆæ—…è¡Œå•†é—®é¢˜ï¼‰
            optimized_order = self.solve_tsp(locations)

            # é‡æ–°æ’åˆ—è¡Œç¨‹
            day.reorder(optimized_order)

        return itinerary

    def solve_tsp(self, locations: List[Location]) -> List[int]:
        """è§£å†³æ—…è¡Œå•†é—®é¢˜ï¼ˆç®€åŒ–ç‰ˆï¼šè´ªå¿ƒç®—æ³•ï¼‰"""

        # è´ªå¿ƒç®—æ³•ï¼šæ¯æ¬¡é€‰æ‹©æœ€è¿‘çš„ä¸‹ä¸€ä¸ªç‚¹
        n = len(locations)
        visited = [False] * n
        order = [0]
        visited[0] = True

        for _ in range(n - 1):
            current = order[-1]
            min_dist = float('inf')
            next_idx = -1

            for i in range(n):
                if not visited[i]:
                    dist = self.calculate_distance(
                        locations[current],
                        locations[i]
                    )
                    if dist < min_dist:
                        min_dist = dist
                        next_idx = i

            order.append(next_idx)
            visited[next_idx] = True

        return order

    def calculate_budget(
        self,
        flights: Flight,
        hotels: Hotel,
        itinerary: Itinerary,
        num_people: int,
        days: int
    ) -> Budget:
        """è®¡ç®—é¢„ç®—"""

        # äº¤é€šè´¹ç”¨
        transport_cost = (flights.price * 2) * num_people  # å¾€è¿”

        # ä½å®¿è´¹ç”¨
        accommodation_cost = hotels.price * (days - 1) * num_people  # N-1 æ™š

        # é¤é¥®è´¹ç”¨
        food_cost = 0
        for day in itinerary.days:
            if day.lunch:
                food_cost += day.lunch.average_cost
            if day.dinner:
                food_cost += day.dinner.average_cost
        food_cost *= num_people

        # é—¨ç¥¨è´¹ç”¨
        ticket_cost = sum(
            day.morning.ticket_price if day.morning else 0
            for day in itinerary.days
        ) * num_people

        # å…¶ä»–è´¹ç”¨ï¼ˆé¢„ä¼° 10%ï¼‰
        other_cost = (transport_cost + accommodation_cost + food_cost + ticket_cost) * 0.1

        return Budget(
            transport=transport_cost,
            accommodation=accommodation_cost,
            food=food_cost,
            tickets=ticket_cost,
            other=other_cost,
            total=transport_cost + accommodation_cost + food_cost + ticket_cost + other_cost
        )

    async def optimize_budget(
        self,
        flights: FlightSearchResult,
        hotels: HotelSearchResult,
        itinerary: Itinerary,
        target_budget: float
    ) -> TravelPlan:
        """ä¼˜åŒ–é¢„ç®—ï¼ˆåœ¨ç›®æ ‡é¢„ç®—å†…ï¼‰"""

        # ç­–ç•¥1: é€‰æ‹©æ›´ä¾¿å®œçš„èˆªç­
        # ç­–ç•¥2: é€‰æ‹©æ›´ä¾¿å®œçš„é…’åº—
        # ç­–ç•¥3: å‡å°‘é«˜æ¶ˆè´¹é¤å…
        # ç­–ç•¥4: å‡å°‘ä»˜è´¹æ™¯ç‚¹

        # AI ç”Ÿæˆä¼˜åŒ–å»ºè®®
        prompt = f"""
        å½“å‰é¢„ç®—è¶…æ”¯ï¼Œè¯·ç»™å‡ºä¼˜åŒ–å»ºè®®ï¼š

        å½“å‰æ€»é¢„ç®—: {self.calculate_total(flights, hotels, itinerary)}
        ç›®æ ‡é¢„ç®—: {target_budget}
        è¶…æ”¯: {self.calculate_total(flights, hotels, itinerary) - target_budget}

        å¯é€‰èˆªç­ï¼ˆä»·æ ¼ä»ä½åˆ°é«˜ï¼‰:
        {[f.price for f in flights.flights[:5]]}

        å¯é€‰é…’åº—ï¼ˆä»·æ ¼ä»ä½åˆ°é«˜ï¼‰:
        {[h.price for h in hotels.hotels[:5]]}

        è¯·ç»™å‡ºï¼š
        1. æ¨èçš„èˆªç­ï¼ˆç¼–å·ï¼‰
        2. æ¨èçš„é…’åº—ï¼ˆç¼–å·ï¼‰
        3. è¡Œç¨‹ä¼˜åŒ–å»ºè®®ï¼ˆå‡å°‘å“ªäº›é«˜æ¶ˆè´¹é¡¹ç›®ï¼‰

        è¿”å› JSON
        """

        optimization = await self.gemini.generate(prompt)

        # åº”ç”¨ä¼˜åŒ–
        optimized_flight = flights.flights[optimization.flight_index]
        optimized_hotel = hotels.hotels[optimization.hotel_index]
        optimized_itinerary = self.apply_itinerary_optimization(
            itinerary,
            optimization.itinerary_changes
        )

        # é‡æ–°è®¡ç®—é¢„ç®—
        budget = self.calculate_budget(
            optimized_flight,
            optimized_hotel,
            optimized_itinerary,
            ...
        )

        return TravelPlan(
            flights=optimized_flight,
            hotels=optimized_hotel,
            itinerary=optimized_itinerary,
            budget=budget,
            optimization_applied=True,
            savings=self.calculate_total(...) - budget.total
        )
```

---

### 4. æŠ¥å‘Šç”Ÿæˆæ¨¡å— (Report Generator)

**èŒè´£**: ç”Ÿæˆç¾è§‚çš„æ—…æ¸¸è®¡åˆ’æŠ¥å‘Š

```python
class TravelReportGenerator:
    """æ—…æ¸¸æŠ¥å‘Šç”Ÿæˆå™¨"""

    def generate_full_report(self, plan: TravelPlan) -> Report:
        """ç”Ÿæˆå®Œæ•´æŠ¥å‘Š"""

        report = Report()

        # 1. å°é¢
        report.add_cover(plan.destination, plan.days)

        # 2. æ¦‚è§ˆ
        report.add_section("è¡Œç¨‹æ¦‚è§ˆ", self._render_overview(plan))

        # 3. äº¤é€šæ–¹æ¡ˆ
        report.add_section("âœˆï¸ äº¤é€šå®‰æ’", self._render_flights(plan.flights))

        # 4. ä½å®¿æ–¹æ¡ˆ
        report.add_section("ğŸ¨ ä½å®¿å®‰æ’", self._render_hotels(plan.hotels))

        # 5. è¯¦ç»†è¡Œç¨‹
        for day in plan.itinerary.days:
            report.add_section(
                f"Day {day.day}",
                self._render_day_itinerary(day)
            )

        # 6. ç¾é£Ÿæ¨è
        report.add_section("ğŸœ ç¾é£Ÿæ¨è", self._render_food(plan))

        # 7. é¢„ç®—æ˜ç»†
        report.add_section("ğŸ’° é¢„ç®—æ˜ç»†", self._render_budget(plan.budget))

        # 8. å®ç”¨ä¿¡æ¯
        report.add_section("ğŸ“ æ³¨æ„äº‹é¡¹", self._render_tips(plan.tips))

        # 9. é¢„è®¢é“¾æ¥
        report.add_section("ğŸ”— å¿«æ·é¢„è®¢", self._render_booking_links(plan))

        return report

    def _render_overview(self, plan: TravelPlan) -> str:
        """æ¸²æŸ“æ¦‚è§ˆ"""
        return f"""
## è¡Œç¨‹æ¦‚è§ˆ

**ç›®çš„åœ°**: {plan.destination}
**æ—…è¡Œå¤©æ•°**: {plan.days}å¤©{plan.days-1}å¤œ
**æ€»é¢„ç®—**: Â¥{plan.budget.total:,.0f} ({plan.num_people}äºº)
**äººå‡**: Â¥{plan.budget.total/plan.num_people:,.0f}

**è¡Œç¨‹äº®ç‚¹**:
{chr(10).join(f"- {h}" for h in plan.highlights[:5])}
"""

    def _render_day_itinerary(self, day: DayItinerary) -> str:
        """æ¸²æŸ“å•æ—¥è¡Œç¨‹"""

        return f"""
### Day {day.day}: {day.theme}

**ä¸Šåˆ** ({day.morning.time})
ğŸ“ **{day.morning.attraction}**
- æ¸¸ç©æ—¶é•¿: {day.morning.duration}
- é—¨ç¥¨: Â¥{day.morning.ticket_price}
- äº®ç‚¹: {', '.join(day.morning.highlights)}
- ğŸ’¡ {day.morning.tips}

**åˆé¤** ({day.lunch.time})
ğŸ½ï¸ **{day.lunch.restaurant}**
- èœç³»: {day.lunch.cuisine}
- äººå‡: Â¥{day.lunch.average_cost}
- æ¨è: {', '.join(day.lunch.recommended_dishes)}

**ä¸‹åˆ** ({day.afternoon.time})
ğŸ“ **{day.afternoon.attraction}**
...

**æ™šé¤** ({day.dinner.time})
ğŸ½ï¸ **{day.dinner.restaurant}**
...

---
**ä»Šæ—¥é¢„ç®—**: Â¥{day.total_cost}
**ä»Šæ—¥æ­¥æ•°**: çº¦ {day.estimated_steps} æ­¥
"""

    def export_to_pdf(self, report: Report) -> bytes:
        """å¯¼å‡º PDF"""

        # ä½¿ç”¨ WeasyPrint
        html = report.to_html()
        pdf = weasyprint.HTML(string=html).write_pdf()
        return pdf

    def export_to_html(self, report: Report) -> str:
        """å¯¼å‡º HTMLï¼ˆå¸¦äº¤äº’åœ°å›¾ï¼‰"""

        template = """
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>{{ plan.destination }}æ—…æ¸¸æ”»ç•¥</title>
    <style>
        body { font-family: -apple-system, sans-serif; }
        .day { border-left: 3px solid #FF2442; padding-left: 20px; margin: 20px 0; }
        .budget { background: #f5f5f5; padding: 20px; border-radius: 8px; }
    </style>
    <script src="https://webapi.amap.com/maps?v=2.0&key=YOUR_KEY"></script>
</head>
<body>
    {{ report.content }}

    <!-- åœ°å›¾ -->
    <div id="map" style="width:100%; height:400px;"></div>
    <script>
        // åˆå§‹åŒ–åœ°å›¾
        var map = new AMap.Map('map');

        // æ ‡æ³¨æ™¯ç‚¹
        var markers = {{ plan.attractions_coords }};
        markers.forEach(m => {
            new AMap.Marker({ position: m.coords, map: map });
        });
    </script>
</body>
</html>
        """

        return jinja2.Template(template).render(report=report, plan=plan)
```

---

## AI æ™ºèƒ½å¼•æ“

### Gemini å¤šæ¨¡æ€åº”ç”¨

```python
class GeminiTravelAssistant:
    """Gemini æ—…æ¸¸åŠ©æ‰‹"""

    def __init__(self):
        self.llm = ChatGoogleGenerativeAI(
            model='gemini-2.0-flash-exp',
            temperature=0.3
        )

    async def analyze_guide_with_images(
        self,
        post: Post
    ) -> GuideAnalysis:
        """å¤šæ¨¡æ€åˆ†ææ”»ç•¥ï¼ˆæ–‡å­—+å›¾ç‰‡ï¼‰"""

        # Gemini æ”¯æŒå›¾ç‰‡è¾“å…¥
        prompt = f"""
        åˆ†æè¿™ç¯‡æ—…æ¸¸æ”»ç•¥ï¼š

        æ ‡é¢˜: {post.title}
        æ­£æ–‡: {post.content}
        å›¾ç‰‡æ•°é‡: {len(post.images)}

        è¯·ä»å›¾ç‰‡ä¸­è¯†åˆ«ï¼š
        1. æ™¯ç‚¹åœºæ™¯ï¼ˆè‡ªç„¶é£å…‰/å†å²å»ºç­‘/ç°ä»£éƒ½å¸‚ï¼‰
        2. ç¾é£Ÿç…§ç‰‡ï¼ˆèœå“ç±»å‹ï¼‰
        3. ä½å®¿ç¯å¢ƒï¼ˆé…’åº—/æ°‘å®¿é£æ ¼ï¼‰

        ä»æ–‡å­—ä¸­æå–ï¼š
        1. è¡Œç¨‹å®‰æ’
        2. é¢„ç®—ä¿¡æ¯
        3. æ³¨æ„äº‹é¡¹

        è¿”å› JSON
        """

        # å¤šæ¨¡æ€è¾“å…¥
        messages = [
            {"role": "user", "content": prompt}
        ]

        # æ·»åŠ å›¾ç‰‡
        for img_url in post.images[:5]:  # æœ€å¤š5å¼ 
            messages.append({
                "role": "user",
                "content": {
                    "type": "image_url",
                    "image_url": img_url
                }
            })

        result = await self.llm.ainvoke(messages)
        return GuideAnalysis(**json.loads(result.content))

    async def generate_personalized_plan(
        self,
        guide: DestinationGuide,
        user_profile: UserProfile
    ) -> PersonalizedPlan:
        """ç”Ÿæˆä¸ªæ€§åŒ–è®¡åˆ’"""

        prompt = f"""
        æ ¹æ®ç”¨æˆ·ç”»åƒå®šåˆ¶æ—…æ¸¸è®¡åˆ’ï¼š

        ç”¨æˆ·ç”»åƒ:
        - å¹´é¾„: {user_profile.age}
        - å…´è¶£: {user_profile.interests}
        - æ—…è¡Œç»éªŒ: {user_profile.experience}
        - èº«ä½“çŠ¶å†µ: {user_profile.physical_condition}
        - é¢„ç®—åå¥½: {user_profile.budget_preference}

        ç›®çš„åœ°ä¿¡æ¯:
        {json.dumps(guide.dict(), ensure_ascii=False)}

        è¯·ç”Ÿæˆä¸ªæ€§åŒ–å»ºè®®ï¼š
        1. æ¨èæ™¯ç‚¹ï¼ˆç¬¦åˆå…´è¶£å’Œä½“èƒ½ï¼‰
        2. è¡Œç¨‹èŠ‚å¥ï¼ˆè€ƒè™‘å¹´é¾„å’Œä½“åŠ›ï¼‰
        3. é¤é¥®å»ºè®®ï¼ˆè€ƒè™‘é¥®é£Ÿåå¥½ï¼‰
        4. ç‰¹åˆ«æç¤ºï¼ˆå¥åº·ã€å®‰å…¨ï¼‰
        """

        result = await self.llm.ainvoke(prompt)
        return PersonalizedPlan(**json.loads(result.content))
```

---

## æ•°æ®æ¨¡å‹

### æ ¸å¿ƒæ•°æ®ç»“æ„

```python
from dataclasses import dataclass
from datetime import datetime, date
from typing import List, Optional
from enum import Enum

# ============================================================
# è¯·æ±‚æ¨¡å‹
# ============================================================

@dataclass
class PlanRequest:
    """è§„åˆ’è¯·æ±‚"""
    destination: str           # ç›®çš„åœ°
    from_city: str            # å‡ºå‘åŸå¸‚
    start_date: date          # å¼€å§‹æ—¥æœŸ
    end_date: date            # ç»“æŸæ—¥æœŸ
    days: int                 # å¤©æ•°
    num_people: int           # äººæ•°
    total_budget: float       # æ€»é¢„ç®—
    preferences: UserPreferences  # åå¥½

@dataclass
class UserPreferences:
    """ç”¨æˆ·åå¥½"""
    interests: List[str]      # å…´è¶£: ["è‡ªç„¶", "å†å²", "ç¾é£Ÿ"]
    pace: str                 # èŠ‚å¥: "relaxed" | "moderate" | "fast"
    budget_level: str         # é¢„ç®—: "budget" | "moderate" | "luxury"
    accommodation_type: str   # ä½å®¿: "hotel" | "hostel" | "airbnb"

# ============================================================
# æ”»ç•¥æ•°æ®
# ============================================================

@dataclass
class Attraction:
    """æ™¯ç‚¹"""
    name: str
    location: str
    ticket_price: float
    visit_duration: str       # "2å°æ—¶"
    highlights: List[str]
    tips: List[str]
    rating: float             # è¯„åˆ†
    mention_count: int        # æåŠæ¬¡æ•°
    popularity_score: float   # çƒ­åº¦åˆ†æ•°

@dataclass
class Restaurant:
    """é¤å…"""
    name: str
    cuisine: str              # èœç³»
    average_cost: float       # äººå‡æ¶ˆè´¹
    recommended_dishes: List[str]
    location: str
    rating: float
    mention_count: int

@dataclass
class DestinationGuide:
    """ç›®çš„åœ°æ”»ç•¥æ±‡æ€»"""
    destination: str
    attractions: List[Attraction]
    restaurants: List[Restaurant]
    sample_routes: List[dict]
    tips: List[str]

# ============================================================
# ä»·æ ¼æ•°æ®
# ============================================================

@dataclass
class Flight:
    """èˆªç­"""
    flight_no: str
    airline: str
    departure_time: datetime
    arrival_time: datetime
    duration: str             # "2h30m"
    price: float
    cabin_class: str          # "ç»æµèˆ±" | "å•†åŠ¡èˆ±"
    source: str               # "æºç¨‹" | "å»å“ªå„¿"

@dataclass
class Hotel:
    """é…’åº—"""
    name: str
    location: str
    coords: dict              # {"lat": ..., "lng": ...}
    price: float              # æ¯æ™šä»·æ ¼
    rating: float
    facilities: List[str]
    distance_to_center: float # è·ç¦»å¸‚ä¸­å¿ƒ km
    source: str

# ============================================================
# è¡Œç¨‹æ•°æ®
# ============================================================

@dataclass
class TimeSlot:
    """æ—¶é—´æ®µæ´»åŠ¨"""
    time: str                 # "09:00-11:00"
    attraction: Optional[str]
    duration: str
    ticket_price: float
    highlights: List[str]
    tips: str

@dataclass
class Meal:
    """é¤é¥®"""
    time: str
    restaurant: str
    cuisine: str
    average_cost: float
    recommended_dishes: List[str]

@dataclass
class DayItinerary:
    """å•æ—¥è¡Œç¨‹"""
    day: int
    theme: str                # "å¤åŸæ–‡åŒ–ä¹‹æ—…"
    morning: TimeSlot
    lunch: Meal
    afternoon: TimeSlot
    dinner: Meal
    evening: Optional[TimeSlot]
    notes: str
    total_cost: float
    estimated_steps: int      # é¢„è®¡æ­¥æ•°

@dataclass
class Itinerary:
    """å®Œæ•´è¡Œç¨‹"""
    days: List[DayItinerary]

# ============================================================
# é¢„ç®—æ•°æ®
# ============================================================

@dataclass
class Budget:
    """é¢„ç®—æ˜ç»†"""
    transport: float          # äº¤é€š
    accommodation: float      # ä½å®¿
    food: float              # é¤é¥®
    tickets: float           # é—¨ç¥¨
    other: float             # å…¶ä»–
    total: float             # æ€»è®¡

# ============================================================
# æœ€ç»ˆè®¡åˆ’
# ============================================================

@dataclass
class TravelPlan:
    """æ—…æ¸¸è®¡åˆ’"""
    destination: str
    days: int
    num_people: int
    flights: Flight
    hotels: Hotel
    itinerary: Itinerary
    budget: Budget
    highlights: List[str]
    tips: List[str]
    booking_links: dict       # é¢„è®¢é“¾æ¥
    created_at: datetime
```

---

## æŠ€æœ¯æ ˆ

### å®Œæ•´æŠ€æœ¯æ ˆ

| å±‚æ¬¡ | æŠ€æœ¯é€‰å‹ | è¯´æ˜ |
|-----|---------|------|
| **å‰ç«¯** | React + TypeScript | Web UI |
| | å¾®ä¿¡å°ç¨‹åº | å°ç¨‹åºç«¯ |
| | Flutter | APP ç«¯ï¼ˆå¯é€‰ï¼‰ |
| **API** | FastAPI + GraphQL | REST + GraphQL |
| **ä¸šåŠ¡å±‚** | Python 3.11+ | æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ |
| **AI** | Google Gemini 2.0 | å¤šæ¨¡æ€ AI åˆ†æ |
| | LangChain | LLM åº”ç”¨æ¡†æ¶ |
| **æ•°æ®é‡‡é›†** | browser-use | æµè§ˆå™¨è‡ªåŠ¨åŒ– |
| | æºç¨‹/å»å“ªå„¿ API | å®˜æ–¹ APIï¼ˆä¼˜å…ˆï¼‰ |
| | é«˜å¾·åœ°å›¾ API | åœ°å›¾æœåŠ¡ |
| **æ•°æ®åº“** | PostgreSQL | ä¸»æ•°æ®åº“ |
| | Redis | ç¼“å­˜ + é˜Ÿåˆ— |
| | Qdrant | å‘é‡æ•°æ®åº“ï¼ˆæ”»ç•¥ç›¸ä¼¼åº¦ï¼‰ |
| | OSS/S3 | å›¾ç‰‡å­˜å‚¨ |
| **ä»»åŠ¡é˜Ÿåˆ—** | Celery + Redis | å¼‚æ­¥ä»»åŠ¡ |
| **éƒ¨ç½²** | Docker + K8s | å®¹å™¨åŒ–éƒ¨ç½² |
| **ç›‘æ§** | Prometheus + Grafana | æ€§èƒ½ç›‘æ§ |

### ä¾èµ–æ¸…å•

```txt
# requirements.txt

# Web æ¡†æ¶
fastapi==0.109.0
uvicorn[standard]==0.27.0
graphene==3.3
strawberry-graphql==0.219.0

# æ•°æ®é‡‡é›†
browser-use>=0.1.0
playwright==1.40.0
httpx==0.26.0

# AI
langchain-google-genai==1.0.0
google-generativeai==0.3.0

# æ•°æ®åº“
sqlalchemy==2.0.25
psycopg2-binary==2.9.9
redis==5.0.1
qdrant-client==1.7.0

# ä»»åŠ¡é˜Ÿåˆ—
celery==5.3.6

# æ•°æ®å¤„ç†
pandas==2.1.4
numpy==1.26.3

# åœ°å›¾å’Œè·¯çº¿
aiohttp==3.9.1  # é«˜å¾·åœ°å›¾ API

# æŠ¥å‘Šç”Ÿæˆ
jinja2==3.1.3
weasyprint==60.2
pillow==10.2.0

# å·¥å…·
python-dotenv==1.0.0
pydantic==2.5.0
```

---

## å®ç°æµç¨‹

### å®Œæ•´æµç¨‹å›¾

```
ç”¨æˆ·è¾“å…¥
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. å‚æ•°éªŒè¯                             â”‚
â”‚ - æ—¥æœŸåˆæ³•æ€§                            â”‚
â”‚ - é¢„ç®—åˆç†æ€§                            â”‚
â”‚ - åŸå¸‚ä»£ç è½¬æ¢                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. æ•°æ®æ”¶é›†ï¼ˆå¹¶è¡Œï¼‰                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚å°çº¢ä¹¦   â”‚ â”‚æºç¨‹æœºç¥¨ â”‚ â”‚æºç¨‹é…’åº— â”‚   â”‚
â”‚ â”‚æ”»ç•¥æ”¶é›† â”‚ â”‚ä»·æ ¼æŸ¥è¯¢ â”‚ â”‚ä»·æ ¼æŸ¥è¯¢ â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚      â†“           â†“           â†“         â”‚
â”‚ AIæå–ä¿¡æ¯   æ’åºç­›é€‰   æ’åºç­›é€‰       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. æ•°æ®èšåˆ                             â”‚
â”‚ - æ™¯ç‚¹å»é‡å’Œæ’åº                        â”‚
â”‚ - é¤å…å»é‡å’Œæ’åº                        â”‚
â”‚ - èˆªç­ä»·æ ¼å¯¹æ¯”                          â”‚
â”‚ - é…’åº—æ€§ä»·æ¯”è®¡ç®—                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. AI è¡Œç¨‹è§„åˆ’                          â”‚
â”‚ - æ ¹æ®å¤©æ•°åˆ†é…æ™¯ç‚¹                      â”‚
â”‚ - ä¼˜åŒ–è·¯çº¿é¡ºåºï¼ˆTSPï¼‰                   â”‚
â”‚ - å®‰æ’é¤é¥®                              â”‚
â”‚ - è®¡ç®—æ—¶é—´å’Œè·ç¦»                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. é¢„ç®—è®¡ç®—                             â”‚
â”‚ - äº¤é€šè´¹ç”¨                              â”‚
â”‚ - ä½å®¿è´¹ç”¨                              â”‚
â”‚ - é¤é¥®è´¹ç”¨                              â”‚
â”‚ - é—¨ç¥¨è´¹ç”¨                              â”‚
â”‚ - å…¶ä»–è´¹ç”¨                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. é¢„ç®—ä¼˜åŒ–ï¼ˆå¦‚è¶…æ”¯ï¼‰                   â”‚
â”‚ - è°ƒæ•´èˆªç­/é…’åº—æ¡£æ¬¡                     â”‚
â”‚ - ä¼˜åŒ–é¤é¥®å®‰æ’                          â”‚
â”‚ - å‡å°‘ä»˜è´¹æ™¯ç‚¹                          â”‚
â”‚ - ç»™å‡ºå¤šç§æ–¹æ¡ˆ                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. æŠ¥å‘Šç”Ÿæˆ                             â”‚
â”‚ - HTML äº¤äº’ç‰ˆï¼ˆå«åœ°å›¾ï¼‰                 â”‚
â”‚ - PDF æ‰“å°ç‰ˆ                            â”‚
â”‚ - JSON æ•°æ®ç‰ˆ                           â”‚
â”‚ - å°ç¨‹åºåˆ†äº«ç‰ˆ                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
è¿”å›ç»™ç”¨æˆ·
```

### API è°ƒç”¨ç¤ºä¾‹

```python
# API è¯·æ±‚
POST /api/v1/travel/plan

{
  "destination": "æˆéƒ½",
  "from_city": "åŒ—äº¬",
  "start_date": "2025-05-01",
  "end_date": "2025-05-05",
  "num_people": 2,
  "total_budget": 10000,
  "preferences": {
    "interests": ["ç¾é£Ÿ", "æ–‡åŒ–", "è‡ªç„¶"],
    "pace": "moderate",
    "budget_level": "moderate",
    "accommodation_type": "hotel"
  }
}

# API å“åº”
{
  "plan_id": "uuid",
  "status": "completed",
  "plan": {
    "destination": "æˆéƒ½",
    "days": 5,
    "flights": {...},
    "hotels": {...},
    "itinerary": {
      "days": [...]
    },
    "budget": {
      "transport": 2660,
      "accommodation": 2800,
      "food": 1200,
      "tickets": 500,
      "other": 500,
      "total": 7660
    },
    "highlights": [...],
    "tips": [...]
  },
  "report_urls": {
    "html": "https://example.com/report/uuid.html",
    "pdf": "https://example.com/report/uuid.pdf"
  }
}
```

---

## å¯è¡Œæ€§åˆ†æ

### æŠ€æœ¯å¯è¡Œæ€§ â­â­â­â­â­

| æ¨¡å— | å¯è¡Œæ€§ | è¯´æ˜ |
|-----|--------|------|
| **å°çº¢ä¹¦æ”»ç•¥æ”¶é›†** | âœ… å®Œå…¨å¯è¡Œ | å·²æœ‰æˆç†Ÿå®ç°ï¼ˆxiaohongshu_collector.pyï¼‰ |
| **æºç¨‹ä»·æ ¼æŸ¥è¯¢** | âœ… å¯è¡Œ | å®˜æ–¹ APIï¼ˆéœ€ç”³è¯·ï¼‰æˆ–æµè§ˆå™¨è‡ªåŠ¨åŒ– |
| **AI åˆ†æ** | âœ… å®Œå…¨å¯è¡Œ | Gemini 2.0 å¤šæ¨¡æ€èƒ½åŠ›å¼ºå¤§ |
| **è¡Œç¨‹è§„åˆ’** | âœ… å®Œå…¨å¯è¡Œ | AI ç”Ÿæˆ + ç®—æ³•ä¼˜åŒ– |
| **é¢„ç®—è®¡ç®—** | âœ… å®Œå…¨å¯è¡Œ | ç®€å•æ•°å­¦è®¡ç®— |
| **æŠ¥å‘Šç”Ÿæˆ** | âœ… å®Œå…¨å¯è¡Œ | Jinja2 + WeasyPrint |

**æ€»ä½“è¯„ä¼°**: æŠ€æœ¯ä¸Šå®Œå…¨å¯è¡Œï¼Œæ ¸å¿ƒæ¨¡å—éƒ½æœ‰æˆç†Ÿæ–¹æ¡ˆ

---

### å•†ä¸šå¯è¡Œæ€§ â­â­â­â­â­

**å¸‚åœºéœ€æ±‚**:
- âœ… æ—…æ¸¸è§„åˆ’æ˜¯åˆšéœ€
- âœ… ç”¨æˆ·ç—›ç‚¹æ˜ç¡®ï¼ˆä¿¡æ¯åˆ†æ•£ã€è§„åˆ’éº»çƒ¦ï¼‰
- âœ… æ„¿æ„ä¸ºä¾¿åˆ©æ€§ä»˜è´¹

**ç«å“åˆ†æ**:

| äº§å“ | ä¼˜åŠ¿ | åŠ£åŠ¿ |
|-----|------|------|
| **é©¬èœ‚çª** | å†…å®¹ä¸°å¯Œ | éœ€è¦æ‰‹åŠ¨æ•´ç† |
| **ç©·æ¸¸** | è·¯çº¿å¤š | ä»·æ ¼ä¸å®æ—¶ |
| **æºç¨‹** | é¢„è®¢æ–¹ä¾¿ | æ”»ç•¥è´¨é‡ä¸€èˆ¬ |
| **æˆ‘ä»¬çš„äº§å“** | AI è‡ªåŠ¨åŒ– + å®æ—¶ä»·æ ¼ + å®Œæ•´è§„åˆ’ | æ–°äº§å“éœ€è¦æ¨å¹¿ |

**å·®å¼‚åŒ–**:
1. ğŸ”¥ **AI è‡ªåŠ¨åŒ–**: ä¸€é”®ç”Ÿæˆå®Œæ•´è®¡åˆ’
2. ğŸ”¥ **å®æ—¶ä»·æ ¼**: æºç¨‹ç­‰å¹³å°å®æ—¶æŸ¥è¯¢
3. ğŸ”¥ **çœŸå®æ”»ç•¥**: å°çº¢ä¹¦ç”¨æˆ·çœŸå®åˆ†äº«
4. ğŸ”¥ **é¢„ç®—ä¼˜åŒ–**: è‡ªåŠ¨æ§åˆ¶å’Œä¼˜åŒ–é¢„ç®—
5. ğŸ”¥ **ä¸€ç«™å¼**: ä»æ”»ç•¥åˆ°é¢„è®¢å…¨æµç¨‹

**å•†ä¸šæ¨¡å¼**:
1. **å…è´¹ç‰ˆ**: åŸºç¡€è§„åˆ’ï¼ˆæœ‰å¹¿å‘Šï¼‰
2. **ä¼šå‘˜ç‰ˆ**: Â¥19.9/æœˆ æˆ– Â¥99/å¹´
   - æ— é™æ¬¡è§„åˆ’
   - æ— å¹¿å‘Š
   - PDF å¯¼å‡º
   - ä»·æ ¼é¢„è­¦
3. **ä¼ä¸šç‰ˆ**: å®šåˆ¶åŒ–æœåŠ¡
4. **ä½£é‡‘æ¨¡å¼**: æºç¨‹/å»å“ªå„¿è¿”ä½£

**ä¼°ç®—æ”¶ç›Š**:
- ç”¨æˆ·è§„æ¨¡: 10ä¸‡ï¼ˆç¬¬ä¸€å¹´ï¼‰
- è½¬åŒ–ç‡: 5% â†’ 5000 ä»˜è´¹ç”¨æˆ·
- å®¢å•ä»·: Â¥100/å¹´
- å¹´æ”¶å…¥: Â¥50ä¸‡
- åŠ ä¸Šä½£é‡‘: Â¥80-100ä¸‡

---

### å¼€å‘æˆæœ¬ â­â­â­

**äººåŠ›æˆæœ¬**:
- åç«¯å¼€å‘: 1äºº Ã— 2ä¸ªæœˆ
- å‰ç«¯å¼€å‘: 1äºº Ã— 1ä¸ªæœˆ
- UIè®¾è®¡: 0.5äºº Ã— 1ä¸ªæœˆ
- æµ‹è¯•: 0.5äºº Ã— 1ä¸ªæœˆ

**æ€»è®¡**: çº¦ 3-4 äººæœˆ

**æŠ€æœ¯æˆæœ¬**:
- Gemini API: Â¥1000/æœˆï¼ˆåˆæœŸï¼‰
- æœåŠ¡å™¨: Â¥500/æœˆ
- æ•°æ®åº“: Â¥300/æœˆ
- æºç¨‹ API: çœ‹è°ƒç”¨é‡
- **æ€»è®¡**: Â¥2000-3000/æœˆ

**å¼€å‘å‘¨æœŸ**: 2-3ä¸ªæœˆ MVP

---

## æŒ‘æˆ˜ä¸è§£å†³æ–¹æ¡ˆ

### æŒ‘æˆ˜1: æºç¨‹åçˆ¬è™« âš ï¸

**é—®é¢˜**: æºç¨‹æœ‰ä¸¥æ ¼çš„åçˆ¬è™«æœºåˆ¶

**è§£å†³æ–¹æ¡ˆ**:
1. **ä¼˜å…ˆä½¿ç”¨å®˜æ–¹ API**ï¼ˆéœ€è¦ç”³è¯·ä¼ä¸šè´¦å·ï¼‰
2. **Browser Use Cloud**ï¼ˆå®˜æ–¹äº‘æµè§ˆå™¨ï¼Œç»•è¿‡åçˆ¬è™«ï¼‰
3. **IP è½®æ¢ + è¯·æ±‚é™é€Ÿ**ï¼ˆé™çº§æ–¹æ¡ˆï¼‰
4. **ç¼“å­˜ç­–ç•¥**ï¼ˆå‡å°‘è¯·æ±‚é¢‘ç‡ï¼‰

```python
# å¤šç­–ç•¥è·å–ä»·æ ¼
async def get_flight_price(self, ...):
    try:
        # ç­–ç•¥1: å®˜æ–¹ API
        return await self.ctrip_api.search_flights(...)
    except:
        try:
            # ç­–ç•¥2: Browser Use Cloud
            return await self.browser_cloud.search_flights(...)
        except:
            # ç­–ç•¥3: ç¼“å­˜æ•°æ®ï¼ˆå¯èƒ½ä¸æ˜¯æœ€æ–°ï¼‰
            return await self.cache.get_cached_flights(...)
```

---

### æŒ‘æˆ˜2: AI ç†è§£å‡†ç¡®æ€§ âš ï¸

**é—®é¢˜**: AI æå–çš„ä¿¡æ¯å¯èƒ½ä¸å‡†ç¡®

**è§£å†³æ–¹æ¡ˆ**:
1. **å¤šå¸–å­éªŒè¯**ï¼ˆåŒä¸€æ™¯ç‚¹å‡ºç°åœ¨å¤šç¯‡æ”»ç•¥ä¸­ï¼‰
2. **ç½®ä¿¡åº¦è¯„åˆ†**ï¼ˆAI ç»™å‡ºç½®ä¿¡åº¦ï¼‰
3. **äººå·¥æ ¡éªŒ**ï¼ˆé‡è¦ä¿¡æ¯äººå·¥å®¡æ ¸ï¼‰
4. **ç”¨æˆ·åé¦ˆ**ï¼ˆç”¨æˆ·çº é”™ï¼‰

```python
# æ™¯ç‚¹ä¿¡æ¯éªŒè¯
def verify_attraction(self, attr: Attraction, all_posts: List[Post]) -> Attraction:
    # ç»Ÿè®¡æåŠæ¬¡æ•°
    mentions = sum(1 for p in all_posts if attr.name in p.content)

    # ç½®ä¿¡åº¦ = æåŠæ¬¡æ•° / æ€»å¸–å­æ•°
    attr.confidence = mentions / len(all_posts)

    # ä½äºé˜ˆå€¼æ ‡è®°ä¸º"éœ€è¦éªŒè¯"
    if attr.confidence < 0.3:
        attr.need_verify = True

    return attr
```

---

### æŒ‘æˆ˜3: å®æ—¶æ€§è¦æ±‚ âš ï¸

**é—®é¢˜**: ä»·æ ¼å˜åŒ–å¿«ï¼Œéœ€è¦å®æ—¶æŸ¥è¯¢

**è§£å†³æ–¹æ¡ˆ**:
1. **æ™ºèƒ½ç¼“å­˜**ï¼ˆä¸åŒæ—¶æ®µä¸åŒç¼“å­˜æ—¶é•¿ï¼‰
2. **ä»·æ ¼é¢„è­¦**ï¼ˆä»·æ ¼å˜åŒ–æ—¶é€šçŸ¥ç”¨æˆ·ï¼‰
3. **å¼‚æ­¥æ›´æ–°**ï¼ˆåå°æ›´æ–°ç¼“å­˜ï¼‰

```python
# æ™ºèƒ½ç¼“å­˜ç­–ç•¥
def get_cache_ttl(self, query_date: date) -> int:
    days_until = (query_date - date.today()).days

    if days_until < 7:
        return 1800   # 30åˆ†é’Ÿï¼ˆä¸´è¿‘å‡ºå‘ï¼Œé¢‘ç¹æ›´æ–°ï¼‰
    elif days_until < 30:
        return 3600   # 1å°æ—¶
    else:
        return 7200   # 2å°æ—¶ï¼ˆæå‰å¾ˆä¹…ï¼Œä¸å¸¸æ›´æ–°ï¼‰
```

---

### æŒ‘æˆ˜4: è·¯çº¿ä¼˜åŒ–å¤æ‚åº¦ âš ï¸

**é—®é¢˜**: TSP é—®é¢˜æ˜¯ NP-hardï¼Œæ™¯ç‚¹å¤šæ—¶è®¡ç®—æ…¢

**è§£å†³æ–¹æ¡ˆ**:
1. **é™åˆ¶æ™¯ç‚¹æ•°é‡**ï¼ˆæ¯å¤©æœ€å¤š 3-4 ä¸ªæ™¯ç‚¹ï¼‰
2. **è´ªå¿ƒç®—æ³•**ï¼ˆè¿‘ä¼¼è§£ï¼Œé€Ÿåº¦å¿«ï¼‰
3. **é¢„è®¡ç®—**ï¼ˆå¸¸è§è·¯çº¿é¢„è®¡ç®—ï¼‰

```python
# è´ªå¿ƒ TSPï¼ˆO(nÂ²)ï¼‰
def optimize_route(self, attractions: List[Attraction]) -> List[Attraction]:
    if len(attractions) <= 3:
        # å°‘äº3ä¸ªï¼Œæš´åŠ›æšä¸¾
        return self.brute_force_tsp(attractions)
    else:
        # è´ªå¿ƒç®—æ³•
        return self.greedy_tsp(attractions)
```

---

## å¼€å‘è·¯çº¿å›¾

### MVP ç‰ˆæœ¬ï¼ˆ1ä¸ªæœˆï¼‰â­

**æ ¸å¿ƒåŠŸèƒ½**:
- âœ… å°çº¢ä¹¦æ”»ç•¥æ”¶é›†
- âœ… AI ä¿¡æ¯æå–
- âœ… æºç¨‹ä»·æ ¼æŸ¥è¯¢ï¼ˆæµè§ˆå™¨è‡ªåŠ¨åŒ–ï¼‰
- âœ… ç®€å•è¡Œç¨‹ç”Ÿæˆ
- âœ… é¢„ç®—è®¡ç®—
- âœ… HTML æŠ¥å‘Šå¯¼å‡º

**æŠ€æœ¯æ ˆ**:
- Python FastAPI
- browser-use
- Gemini AI
- SQLiteï¼ˆç®€åŒ–ï¼‰

**äº§å“å½¢æ€**: CLI å·¥å…· + ç®€å• Web UI

---

### V1.0 ç‰ˆæœ¬ï¼ˆ2ä¸ªæœˆï¼‰â­â­

**æ–°å¢åŠŸèƒ½**:
- âœ… æºç¨‹å®˜æ–¹ API é›†æˆ
- âœ… å»å“ªå„¿ä»·æ ¼å¯¹æ¯”
- âœ… é«˜å¾·åœ°å›¾è·¯çº¿ä¼˜åŒ–
- âœ… PDF æŠ¥å‘Šå¯¼å‡º
- âœ… å¤šæ–¹æ¡ˆç”Ÿæˆ
- âœ… Web UI å®Œæ•´ç‰ˆ
- âœ… ç”¨æˆ·ç³»ç»Ÿï¼ˆç™»å½•ã€ä¿å­˜è®¡åˆ’ï¼‰

**æŠ€æœ¯å‡çº§**:
- PostgreSQL
- Redis ç¼“å­˜
- Celery å¼‚æ­¥ä»»åŠ¡

---

### V2.0 ç‰ˆæœ¬ï¼ˆ3-4ä¸ªæœˆï¼‰â­â­â­

**æ–°å¢åŠŸèƒ½**:
- âœ… å¾®ä¿¡å°ç¨‹åº
- âœ… ä»·æ ¼é¢„è­¦
- âœ… è¡Œç¨‹åˆ†äº«
- âœ… æ™ºèƒ½æ¨èï¼ˆåŸºäºå†å²ï¼‰
- âœ… å¤šäººåä½œè§„åˆ’
- âœ… é¢„è®¢è·³è½¬ï¼ˆæºç¨‹/å»å“ªå„¿ï¼‰

**æŠ€æœ¯å‡çº§**:
- å‘é‡æ•°æ®åº“ï¼ˆç›¸ä¼¼æ”»ç•¥æ¨èï¼‰
- ç”¨æˆ·ç”»åƒç³»ç»Ÿ
- æ¨èç®—æ³•

---

### V3.0 ç‰ˆæœ¬ï¼ˆé•¿æœŸï¼‰â­â­â­â­

**æ–°å¢åŠŸèƒ½**:
- âœ… APP ç‰ˆæœ¬ï¼ˆFlutterï¼‰
- âœ… å›½é™…ç‰ˆï¼ˆå¢ƒå¤–æ—…æ¸¸ï¼‰
- âœ… AI è¯­éŸ³åŠ©æ‰‹
- âœ… AR å¯¼è§ˆ
- âœ… ç¤¾åŒºåˆ†äº«ï¼ˆç”¨æˆ·æ”»ç•¥ï¼‰

---

## é¡¹ç›®ç»“æ„

```
travel-ai-planner/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ main.py
â”‚   â”‚   â”œâ”€â”€ config.py
â”‚   â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”‚   â”œâ”€â”€ travel.py          # æ—…æ¸¸è§„åˆ’ API
â”‚   â”‚   â”‚   â”œâ”€â”€ guides.py          # æ”»ç•¥ API
â”‚   â”‚   â”‚   â””â”€â”€ prices.py          # ä»·æ ¼ API
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â”œâ”€â”€ guide_collector.py # æ”»ç•¥æ”¶é›†
â”‚   â”‚   â”‚   â”œâ”€â”€ price_query.py     # ä»·æ ¼æŸ¥è¯¢
â”‚   â”‚   â”‚   â”œâ”€â”€ ai_planner.py      # AI è§„åˆ’
â”‚   â”‚   â”‚   â””â”€â”€ report_gen.py      # æŠ¥å‘Šç”Ÿæˆ
â”‚   â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â””â”€â”€ tasks.py               # Celery ä»»åŠ¡
â”‚   â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â””â”€â”€ requirements.txt
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ web/                        # Web UI
â”‚   â”œâ”€â”€ miniapp/                    # å¾®ä¿¡å°ç¨‹åº
â”‚   â””â”€â”€ app/                        # Flutter APP
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ ARCHITECTURE.md             # æœ¬æ–‡æ¡£
â”‚   â”œâ”€â”€ API.md
â”‚   â””â”€â”€ DEPLOYMENT.md
â”œâ”€â”€ docker-compose.yml
â””â”€â”€ README.md
```

---

## æ€»ç»“

### æ ¸å¿ƒä¼˜åŠ¿

1. âœ… **æŠ€æœ¯å¯è¡Œ**: 80% ä»£ç å¯å¤ç”¨ç°æœ‰é¡¹ç›®
2. âœ… **AI é©±åŠ¨**: Gemini å¤šæ¨¡æ€åˆ†æèƒ½åŠ›å¼º
3. âœ… **ç”¨æˆ·ä»·å€¼**: è§£å†³çœŸå®ç—›ç‚¹ï¼ˆä¿¡æ¯åˆ†æ•£ã€è§„åˆ’éº»çƒ¦ï¼‰
4. âœ… **å·®å¼‚åŒ–**: AI è‡ªåŠ¨åŒ– + å®æ—¶ä»·æ ¼ + å®Œæ•´è§„åˆ’
5. âœ… **å•†ä¸šæ½œåŠ›**: åˆšéœ€å¸‚åœºï¼Œå˜ç°è·¯å¾„æ¸…æ™°

### å…³é”®æŒ‡æ ‡

| æŒ‡æ ‡ | è¯„ä¼° |
|-----|------|
| æŠ€æœ¯å¯è¡Œæ€§ | â­â­â­â­â­ |
| å•†ä¸šä»·å€¼ | â­â­â­â­â­ |
| å¼€å‘éš¾åº¦ | â­â­â­ |
| å¼€å‘å‘¨æœŸ | 1ä¸ªæœˆ MVPï¼Œ2-3ä¸ªæœˆå®Œæ•´ç‰ˆ |
| æŠ•å…¥æˆæœ¬ | ä¸­ç­‰ï¼ˆ3-4äººæœˆ + Â¥2-3k/æœˆè¿è¥ï¼‰ |
| å¸‚åœºæ½œåŠ› | â­â­â­â­â­ |

### ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **MVP éªŒè¯**ï¼ˆ1ä¸ªæœˆï¼‰
   - å®ç°æ ¸å¿ƒåŠŸèƒ½
   - å°èŒƒå›´æµ‹è¯•
   - æ”¶é›†ç”¨æˆ·åé¦ˆ

2. **äº§å“è¿­ä»£**ï¼ˆ2-3ä¸ªæœˆï¼‰
   - å®Œå–„åŠŸèƒ½
   - ä¼˜åŒ–ä½“éªŒ
   - æ‰©å¤§ç”¨æˆ·

3. **å•†ä¸šåŒ–**ï¼ˆ3ä¸ªæœˆåï¼‰
   - ä¼šå‘˜ä½“ç³»
   - ä½£é‡‘åˆä½œ
   - ä¼ä¸šæœåŠ¡

---

**è¿™æ˜¯ä¸€ä¸ªéå¸¸æœ‰æ½œåŠ›çš„é¡¹ç›®ï¼** ğŸš€

éœ€è¦æˆ‘å¸®ä½ å¼€å§‹æ­å»º MVP å—ï¼Ÿ
