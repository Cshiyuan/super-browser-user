# å°çº¢ä¹¦èµ·å·æµç¨‹åˆ†æå·¥å…· - æŠ€æœ¯æ¶æ„æ–‡æ¡£

## ğŸ“‹ ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
2. [æ•´ä½“æ¶æ„](#æ•´ä½“æ¶æ„)
3. [æ ¸å¿ƒæ¨¡å—è®¾è®¡](#æ ¸å¿ƒæ¨¡å—è®¾è®¡)
4. [æ•°æ®æ¨¡å‹](#æ•°æ®æ¨¡å‹)
5. [æŠ€æœ¯æ ˆ](#æŠ€æœ¯æ ˆ)
6. [æ•°æ®æµè½¬](#æ•°æ®æµè½¬)
7. [API è®¾è®¡](#api-è®¾è®¡)
8. [ç®—æ³•è®¾è®¡](#ç®—æ³•è®¾è®¡)
9. [éƒ¨ç½²æ–¹æ¡ˆ](#éƒ¨ç½²æ–¹æ¡ˆ)
10. [å¼€å‘è·¯çº¿å›¾](#å¼€å‘è·¯çº¿å›¾)

---

## é¡¹ç›®æ¦‚è¿°

### äº§å“å®šä½

**å°çº¢ä¹¦èµ·å·æµç¨‹åˆ†æå·¥å…·** - é€šè¿‡åˆ†ææˆåŠŸè´¦å·çš„å†å²æ•°æ®ï¼Œæ­ç¤ºå…¶ä» 0 åˆ°æˆåŠŸçš„å®Œæ•´è·¯å¾„ã€‚

### æ ¸å¿ƒåŠŸèƒ½

1. **è´¦å·æ•°æ®æ”¶é›†**: æŠ“å–è´¦å·æ‰€æœ‰å†å²å¸–å­å’Œäº’åŠ¨æ•°æ®
2. **æ—¶é—´åºåˆ—åˆ†æ**: æ„å»ºè´¦å·æˆé•¿æ—¶é—´çº¿
3. **é˜¶æ®µæ™ºèƒ½åˆ’åˆ†**: è‡ªåŠ¨è¯†åˆ«èµ·å·é˜¶æ®µï¼ˆå†·å¯åŠ¨ã€çªç ´æœŸã€æˆç†ŸæœŸï¼‰
4. **çˆ†æ¬¾å†…å®¹è¯†åˆ«**: æ‰¾å‡ºå…³é”®è½¬æŠ˜ç‚¹çš„çˆ†æ¬¾å¸–å­
5. **AI ç­–ç•¥åˆ†æ**: ä½¿ç”¨ AI æå–å¯å¤åˆ¶çš„æˆåŠŸè¦ç´ 
6. **å¯è§†åŒ–æŠ¥å‘Š**: ç”Ÿæˆå›¾è¡¨å’Œæ–‡å­—æŠ¥å‘Š

### ç›®æ ‡ç”¨æˆ·

- ğŸ¯ å°çº¢ä¹¦æ–°äººåšä¸»ï¼ˆå­¦ä¹ èµ·å·è·¯å¾„ï¼‰
- ğŸ“Š å†…å®¹è¿è¥äººå‘˜ï¼ˆä¼˜åŒ–ç­–ç•¥ï¼‰
- ğŸ” æ•°æ®åˆ†æå¸ˆï¼ˆç ”ç©¶å¹³å°è§„å¾‹ï¼‰
- ğŸ’¼ MCN æœºæ„ï¼ˆåŸ¹è®­å’Œå­µåŒ–ï¼‰

---

## æ•´ä½“æ¶æ„

### ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ç”¨æˆ·å±‚                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚   â”‚ Web UI  â”‚  â”‚  CLI    â”‚  â”‚  API    â”‚  â”‚ æµè§ˆå™¨  â”‚      â”‚
â”‚   â”‚         â”‚  â”‚  å·¥å…·   â”‚  â”‚  è°ƒç”¨   â”‚  â”‚  æ’ä»¶   â”‚      â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      API æœåŠ¡å±‚                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚  FastAPI REST API                                 â”‚     â”‚
â”‚   â”‚  - ä»»åŠ¡ç®¡ç†  - æ•°æ®æŸ¥è¯¢  - æŠ¥å‘Šç”Ÿæˆ              â”‚     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ä¸šåŠ¡é€»è¾‘å±‚                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚ æ•°æ®æ”¶é›† â”‚  â”‚ æ—¶é—´åºåˆ— â”‚  â”‚ AI åˆ†æ  â”‚  â”‚ æŠ¥å‘Šç”Ÿæˆ â”‚  â”‚
â”‚   â”‚  æ¨¡å—    â”‚  â”‚  åˆ†æ    â”‚  â”‚  å¼•æ“    â”‚  â”‚  æ¨¡å—    â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æ•°æ®å±‚                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚ browser- â”‚  â”‚ Gemini   â”‚  â”‚PostgreSQLâ”‚  â”‚  Redis   â”‚  â”‚
â”‚   â”‚   use    â”‚  â”‚   AI     â”‚  â”‚  æ•°æ®åº“  â”‚  â”‚  ç¼“å­˜    â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æŠ€æœ¯æ¶æ„å±‚æ¬¡

| å±‚æ¬¡ | èŒè´£ | æŠ€æœ¯é€‰å‹ |
|-----|------|---------|
| **ç”¨æˆ·å±‚** | ç”¨æˆ·äº¤äº’ç•Œé¢ | Web UI (React) / CLI (Click) / Chrome Extension |
| **API å±‚** | æ¥å£æœåŠ¡ | FastAPI + Pydantic |
| **ä¸šåŠ¡å±‚** | æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ | Python 3.11+ |
| **æ•°æ®å±‚** | æ•°æ®å­˜å‚¨å’Œå¤„ç† | PostgreSQL + Redis + browser-use + Gemini |

---

## æ ¸å¿ƒæ¨¡å—è®¾è®¡

### 1. æ•°æ®æ”¶é›†æ¨¡å— (Collector)

**èŒè´£**: æŠ“å–å°çº¢ä¹¦è´¦å·çš„æ‰€æœ‰å†å²æ•°æ®

**æŠ€æœ¯æ–¹æ¡ˆ**: åŸºäºç°æœ‰çš„ `xiaohongshu_collector.py` æ‰©å±•

**å…³é”®åŠŸèƒ½**:
```python
class AccountCollector:
    """è´¦å·æ•°æ®æ”¶é›†å™¨"""

    async def collect_user_profile(self, user_url: str) -> UserProfile:
        """æ”¶é›†è´¦å·åŸºæœ¬ä¿¡æ¯"""
        # - æ˜µç§°ã€ç®€ä»‹ã€ç²‰ä¸æ•°
        # - è·èµæ•°ã€æ”¶è—æ•°
        pass

    async def collect_all_posts(self, user_url: str) -> List[Post]:
        """æ”¶é›†æ‰€æœ‰å†å²å¸–å­"""
        # - æ»šåŠ¨åŠ è½½æ‰€æœ‰å¸–å­
        # - æŒ‰å‘å¸ƒæ—¶é—´æ’åº
        # - æå–å¸–å­åŸºæœ¬ä¿¡æ¯
        pass

    async def collect_post_details(self, post_url: str) -> PostDetail:
        """æ”¶é›†å•ä¸ªå¸–å­è¯¦æƒ…"""
        # - æ ‡é¢˜ã€å†…å®¹ã€å›¾ç‰‡
        # - ç‚¹èµã€æ”¶è—ã€è¯„è®ºæ•°
        # - å‘å¸ƒæ—¶é—´ã€è¯é¢˜æ ‡ç­¾
        # - çƒ­é—¨è¯„è®º
        pass

    async def collect_account_full(self, user_url: str) -> AccountData:
        """æ”¶é›†è´¦å·å®Œæ•´æ•°æ®"""
        profile = await self.collect_user_profile(user_url)
        posts = await self.collect_all_posts(user_url)

        # å¹¶å‘æ”¶é›†æ¯ä¸ªå¸–å­è¯¦æƒ…
        details = await asyncio.gather(*[
            self.collect_post_details(post.url)
            for post in posts
        ])

        return AccountData(profile, posts, details)
```

**æ€§èƒ½ä¼˜åŒ–**:
- å¹¶å‘æ”¶é›†ï¼ˆSemaphore æ§åˆ¶å¹¶å‘æ•°ï¼‰
- å¢é‡æ›´æ–°ï¼ˆåªæŠ“å–æ–°å¸–å­ï¼‰
- ç¼“å­˜æœºåˆ¶ï¼ˆRedis ç¼“å­˜å¸–å­æ•°æ®ï¼‰
- æ–­ç‚¹ç»­ä¼ ï¼ˆä»»åŠ¡ä¸­æ–­å¯æ¢å¤ï¼‰

---

### 2. æ—¶é—´åºåˆ—åˆ†ææ¨¡å— (TimeSeriesAnalyzer)

**èŒè´£**: æ„å»ºè´¦å·æˆé•¿æ—¶é—´çº¿ï¼Œåˆ†ææ•°æ®å˜åŒ–è¶‹åŠ¿

**æ ¸å¿ƒç®—æ³•**:
```python
class TimeSeriesAnalyzer:
    """æ—¶é—´åºåˆ—åˆ†æå™¨"""

    def build_timeline(self, posts: List[Post]) -> Timeline:
        """æ„å»ºæ—¶é—´çº¿"""
        # 1. æŒ‰å‘å¸ƒæ—¶é—´æ’åº
        sorted_posts = sorted(posts, key=lambda p: p.publish_time)

        # 2. è®¡ç®—ç´¯è®¡æ•°æ®
        timeline = []
        for i, post in enumerate(sorted_posts):
            point = {
                "date": post.publish_time,
                "post_index": i + 1,
                "total_posts": i + 1,
                "cumulative_likes": sum(p.likes for p in sorted_posts[:i+1]),
                "avg_likes": np.mean([p.likes for p in sorted_posts[:i+1]]),
                # ç²‰ä¸æ•°æ¨ç®—ï¼ˆåŸºäºäº’åŠ¨æ•°æ®ï¼‰
                "estimated_followers": self.estimate_followers(sorted_posts[:i+1])
            }
            timeline.append(point)

        return Timeline(timeline)

    def find_growth_breakpoints(self, timeline: Timeline) -> List[Breakpoint]:
        """æ‰¾å‡ºå¢é•¿æ‹ç‚¹"""
        # ä½¿ç”¨å˜ç‚¹æ£€æµ‹ç®—æ³•ï¼ˆChange Point Detectionï¼‰
        # 1. è®¡ç®—å¢é•¿ç‡
        growth_rates = np.diff([p.estimated_followers for p in timeline])

        # 2. ä½¿ç”¨ PELT ç®—æ³•æ£€æµ‹å˜ç‚¹
        from ruptures import Pelt
        model = Pelt(model="rbf").fit(growth_rates)
        breakpoints = model.predict(pen=10)

        return [Breakpoint(idx, timeline[idx]) for idx in breakpoints]

    def estimate_followers(self, posts: List[Post]) -> int:
        """æ¨ç®—ç²‰ä¸æ•°"""
        # åŸºäºäº’åŠ¨æ•°æ®æ¨ç®—ç²‰ä¸æ•°
        # å…¬å¼: ç²‰ä¸æ•° â‰ˆ å¹³å‡äº’åŠ¨æ•° / äº’åŠ¨ç‡
        # å‡è®¾äº’åŠ¨ç‡: æ–°è´¦å· 5%, æˆç†Ÿè´¦å· 2%

        avg_engagement = np.mean([p.likes + p.comments + p.collects for p in posts])

        # åŠ¨æ€è°ƒæ•´äº’åŠ¨ç‡
        if len(posts) < 10:
            engagement_rate = 0.05  # æ–°è´¦å·
        elif len(posts) < 50:
            engagement_rate = 0.03  # æˆé•¿æœŸ
        else:
            engagement_rate = 0.02  # æˆç†ŸæœŸ

        return int(avg_engagement / engagement_rate)
```

**æ•°æ®æŒ‡æ ‡**:
- å‘å¸–é¢‘ç‡ï¼ˆå¸–å­/å¤©ï¼‰
- äº’åŠ¨æ•°æ®ï¼ˆç‚¹èµã€æ”¶è—ã€è¯„è®ºï¼‰
- ç²‰ä¸å¢é•¿ç‡ï¼ˆæ¨ç®—ï¼‰
- å†…å®¹ç±»å‹åˆ†å¸ƒ
- å‘å¸–æ—¶é—´åˆ†å¸ƒ

---

### 3. é˜¶æ®µåˆ’åˆ†æ¨¡å— (StageAnalyzer)

**èŒè´£**: æ™ºèƒ½åˆ’åˆ†è´¦å·æˆé•¿é˜¶æ®µ

**é˜¶æ®µå®šä¹‰**:
```python
class GrowthStage(Enum):
    """æˆé•¿é˜¶æ®µæšä¸¾"""
    COLD_START = "å†·å¯åŠ¨æœŸ"      # 0-1000 ç²‰ä¸
    BREAKTHROUGH = "çªç ´æœŸ"       # å‡ºç°çˆ†æ¬¾ï¼Œå¿«é€Ÿå¢é•¿
    GROWTH = "æˆé•¿æœŸ"             # ç¨³å®šå¢é•¿
    MATURE = "æˆç†ŸæœŸ"             # ç²‰ä¸ç¨³å®šï¼Œå•†ä¸šåŒ–

class StageAnalyzer:
    """é˜¶æ®µåˆ†æå™¨"""

    def divide_stages(self, timeline: Timeline, breakpoints: List[Breakpoint]) -> List[Stage]:
        """åˆ’åˆ†æˆé•¿é˜¶æ®µ"""
        stages = []

        # åŸºäºæ‹ç‚¹åˆ’åˆ†é˜¶æ®µ
        for i in range(len(breakpoints)):
            start_idx = breakpoints[i-1].index if i > 0 else 0
            end_idx = breakpoints[i].index

            stage_data = timeline[start_idx:end_idx]

            stage = Stage(
                name=self.classify_stage(stage_data),
                start_date=stage_data[0].date,
                end_date=stage_data[-1].date,
                duration_days=(stage_data[-1].date - stage_data[0].date).days,
                posts=stage_data,
                metrics=self.calculate_stage_metrics(stage_data)
            )
            stages.append(stage)

        return stages

    def classify_stage(self, stage_data: List[TimelinePoint]) -> GrowthStage:
        """åˆ†ç±»é˜¶æ®µç±»å‹"""
        start_followers = stage_data[0].estimated_followers
        end_followers = stage_data[-1].estimated_followers
        growth_rate = (end_followers - start_followers) / start_followers

        # è¯†åˆ«çˆ†æ¬¾é©±åŠ¨çš„çªç ´æœŸ
        has_viral = any(p.likes > np.mean([p.likes for p in stage_data]) * 10
                       for p in stage_data)

        if start_followers < 1000:
            return GrowthStage.COLD_START
        elif has_viral and growth_rate > 1.0:
            return GrowthStage.BREAKTHROUGH
        elif growth_rate > 0.3:
            return GrowthStage.GROWTH
        else:
            return GrowthStage.MATURE

    def calculate_stage_metrics(self, stage_data: List[TimelinePoint]) -> StageMetrics:
        """è®¡ç®—é˜¶æ®µæŒ‡æ ‡"""
        posts = [p.post for p in stage_data]

        return StageMetrics(
            total_posts=len(posts),
            post_frequency=len(posts) / len(stage_data),  # å¸–å­/å¤©
            avg_likes=np.mean([p.likes for p in posts]),
            avg_comments=np.mean([p.comments for p in posts]),
            avg_collects=np.mean([p.collects for p in posts]),
            follower_growth=stage_data[-1].estimated_followers - stage_data[0].estimated_followers,
            content_types=self.analyze_content_types(posts),
            popular_topics=self.extract_popular_topics(posts),
            posting_times=self.analyze_posting_times(posts)
        )
```

---

### 4. çˆ†æ¬¾è¯†åˆ«æ¨¡å— (ViralDetector)

**èŒè´£**: è¯†åˆ«çˆ†æ¬¾å†…å®¹ï¼Œåˆ†æçˆ†æ¬¾ç‰¹å¾

**è¯†åˆ«ç®—æ³•**:
```python
class ViralDetector:
    """çˆ†æ¬¾è¯†åˆ«å™¨"""

    def detect_viral_posts(self, posts: List[Post]) -> List[ViralPost]:
        """è¯†åˆ«çˆ†æ¬¾å¸–å­"""
        viral_posts = []

        # è®¡ç®—å…¨å±€å¹³å‡äº’åŠ¨æ•°
        avg_likes = np.mean([p.likes for p in posts])
        std_likes = np.std([p.likes for p in posts])

        # çˆ†æ¬¾å®šä¹‰: ç‚¹èµæ•° > å‡å€¼ + 2*æ ‡å‡†å·®
        threshold = avg_likes + 2 * std_likes

        for post in posts:
            if post.likes > threshold:
                # è®¡ç®—çˆ†æ¬¾æŒ‡æ•°
                viral_score = self.calculate_viral_score(post, posts)

                viral_posts.append(ViralPost(
                    post=post,
                    viral_score=viral_score,
                    outperform_rate=post.likes / avg_likes,
                    features=self.extract_viral_features(post)
                ))

        return sorted(viral_posts, key=lambda v: v.viral_score, reverse=True)

    def calculate_viral_score(self, post: Post, all_posts: List[Post]) -> float:
        """è®¡ç®—çˆ†æ¬¾æŒ‡æ•°"""
        avg_likes = np.mean([p.likes for p in all_posts])

        # ç»¼åˆæŒ‡æ ‡
        score = (
            (post.likes / avg_likes) * 0.4 +           # ç‚¹èµå€æ•°
            (post.collects / post.likes) * 100 * 0.3 + # æ”¶è—ç‡
            (post.comments / post.likes) * 100 * 0.3   # è¯„è®ºç‡
        )

        return score

    def extract_viral_features(self, post: Post) -> ViralFeatures:
        """æå–çˆ†æ¬¾ç‰¹å¾"""
        return ViralFeatures(
            title_pattern=self.analyze_title(post.title),
            content_type=post.content_type,  # å›¾æ–‡/è§†é¢‘
            image_count=len(post.images),
            word_count=len(post.content),
            topics=post.topics,
            publish_time=post.publish_time,
            day_of_week=post.publish_time.strftime("%A"),
            hour_of_day=post.publish_time.hour
        )

    def analyze_title(self, title: str) -> TitlePattern:
        """åˆ†ææ ‡é¢˜æ¨¡å¼"""
        return TitlePattern(
            has_number=bool(re.search(r'\d+', title)),
            has_emoji=bool(re.search(r'[\U0001F600-\U0001F64F]', title)),
            has_question=bool('?' in title or 'ï¼Ÿ' in title),
            has_exclamation=bool('!' in title or 'ï¼' in title),
            word_count=len(title),
            keywords=self.extract_keywords(title)
        )
```

---

### 5. AI åˆ†æå¼•æ“ (AIAnalyzer)

**èŒè´£**: ä½¿ç”¨ Gemini AI åˆ†æç­–ç•¥ï¼Œç”Ÿæˆæ´å¯ŸæŠ¥å‘Š

**æ ¸å¿ƒæµç¨‹**:
```python
class AIAnalyzer:
    """AI åˆ†æå¼•æ“"""

    def __init__(self):
        self.llm = ChatGoogleGenerativeAI(
            model='gemini-2.0-flash-exp',
            temperature=0.3  # åå‘å®¢è§‚åˆ†æ
        )

    async def analyze_growth_strategy(
        self,
        stages: List[Stage],
        viral_posts: List[ViralPost]
    ) -> StrategyInsights:
        """åˆ†ææˆé•¿ç­–ç•¥"""

        # æ„å»ºåˆ†ææç¤ºè¯
        prompt = self._build_analysis_prompt(stages, viral_posts)

        # AI ç”Ÿæˆåˆ†æ
        response = await self.llm.ainvoke(prompt)

        # è§£æç»“æœ
        insights = self._parse_insights(response.content)

        return insights

    def _build_analysis_prompt(self, stages: List[Stage], viral_posts: List[ViralPost]) -> str:
        """æ„å»ºåˆ†ææç¤ºè¯"""

        # æ•´ç†é˜¶æ®µæ•°æ®
        stages_summary = []
        for stage in stages:
            stages_summary.append({
                "é˜¶æ®µåç§°": stage.name.value,
                "æ—¶é•¿": f"{stage.duration_days}å¤©",
                "å‘å¸–æ•°": stage.metrics.total_posts,
                "å‘å¸–é¢‘ç‡": f"{stage.metrics.post_frequency:.1f}ç¯‡/å¤©",
                "å¹³å‡ç‚¹èµ": int(stage.metrics.avg_likes),
                "ç²‰ä¸å¢é•¿": stage.metrics.follower_growth,
                "å†…å®¹ç±»å‹": stage.metrics.content_types,
                "çƒ­é—¨è¯é¢˜": stage.metrics.popular_topics[:3]
            })

        # æ•´ç†çˆ†æ¬¾æ•°æ®
        viral_summary = []
        for viral in viral_posts[:5]:  # Top 5
            viral_summary.append({
                "æ ‡é¢˜": viral.post.title,
                "ç‚¹èµæ•°": viral.post.likes,
                "çˆ†æ¬¾æŒ‡æ•°": f"{viral.viral_score:.1f}",
                "è¶…è¶Šå€æ•°": f"{viral.outperform_rate:.1f}x",
                "å‘å¸ƒæ—¶é—´": viral.post.publish_time.strftime("%Y-%m-%d %H:%M"),
                "è¯é¢˜æ ‡ç­¾": viral.post.topics[:3],
                "æ ‡é¢˜ç‰¹å¾": {
                    "å«æ•°å­—": viral.features.title_pattern.has_number,
                    "å«emoji": viral.features.title_pattern.has_emoji,
                    "å…³é”®è¯": viral.features.title_pattern.keywords[:3]
                }
            })

        prompt = f"""
ä½ æ˜¯ä¸€ä½èµ„æ·±çš„å°çº¢ä¹¦è¿è¥ä¸“å®¶ï¼Œè¯·åˆ†æä»¥ä¸‹è´¦å·çš„èµ·å·æµç¨‹æ•°æ®ï¼š

## é˜¶æ®µæ•°æ®
{json.dumps(stages_summary, ensure_ascii=False, indent=2)}

## çˆ†æ¬¾å¸–å­ï¼ˆTop 5ï¼‰
{json.dumps(viral_summary, ensure_ascii=False, indent=2)}

è¯·ä»ä»¥ä¸‹ç»´åº¦è¿›è¡Œæ·±åº¦åˆ†æï¼š

### 1. å„é˜¶æ®µæ ¸å¿ƒç­–ç•¥
- æ¯ä¸ªé˜¶æ®µçš„è¿è¥é‡ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ
- å†…å®¹ç­–ç•¥å¦‚ä½•æ¼”å˜ï¼Ÿ
- å‘å¸–èŠ‚å¥å¦‚ä½•å˜åŒ–ï¼Ÿ

### 2. çˆ†æ¬¾å†…å®¹å…±æ€§
- çˆ†æ¬¾å¸–å­æœ‰å“ªäº›å…±åŒç‰¹å¾ï¼Ÿ
- æ ‡é¢˜ã€è¯é¢˜ã€å½¢å¼æœ‰ä»€ä¹ˆè§„å¾‹ï¼Ÿ
- å‘å¸ƒæ—¶é—´æœ‰ä»€ä¹ˆè®²ç©¶ï¼Ÿ

### 3. å…³é”®æˆåŠŸè¦ç´ 
- å“ªäº›å†³ç­–/åŠ¨ä½œæ˜¯æˆåŠŸçš„å…³é”®ï¼Ÿ
- æœ‰å“ªäº›å€¼å¾—å­¦ä¹ çš„ç­–ç•¥ï¼Ÿ
- æœ‰å“ªäº›å¯å¤åˆ¶çš„æ¨¡å¼ï¼Ÿ

### 4. ç»™æ–°äººçš„å»ºè®®
- åŸºäºè¿™ä¸ªæ¡ˆä¾‹ï¼Œç»™æ–°äºº3-5æ¡å¯æ‰§è¡Œçš„å»ºè®®
- æ¯æ¡å»ºè®®è¦å…·ä½“ã€å¯æ“ä½œ

è¯·ç”¨ç»“æ„åŒ–çš„æ–¹å¼è¾“å‡ºï¼ŒåŒ…å«ï¼š
- æ ¸å¿ƒå‘ç°ï¼ˆ3-5æ¡ï¼‰
- é˜¶æ®µç­–ç•¥åˆ†æ
- çˆ†æ¬¾å†…å®¹è§„å¾‹
- å¯å¤åˆ¶å»ºè®®ï¼ˆ3-5æ¡ï¼‰

è¾“å‡ºæ ¼å¼ä¸º JSONï¼š
{{
  "core_findings": ["å‘ç°1", "å‘ç°2", ...],
  "stage_analysis": {{
    "å†·å¯åŠ¨æœŸ": "ç­–ç•¥æè¿°",
    "çªç ´æœŸ": "ç­–ç•¥æè¿°",
    ...
  }},
  "viral_patterns": {{
    "title_patterns": ["æ¨¡å¼1", "æ¨¡å¼2", ...],
    "content_types": ["ç±»å‹1", "ç±»å‹2", ...],
    "posting_times": ["æ—¶é—´è§„å¾‹1", ...]
  }},
  "actionable_tips": [
    {{"tip": "å»ºè®®1", "reason": "åŸå› ", "how_to": "å¦‚ä½•æ‰§è¡Œ"}},
    ...
  ]
}}
"""
        return prompt

    def _parse_insights(self, ai_response: str) -> StrategyInsights:
        """è§£æ AI è¿”å›çš„æ´å¯Ÿ"""
        # æå– JSON
        json_match = re.search(r'```json\s*(\{.*?\})\s*```', ai_response, re.DOTALL)
        if json_match:
            data = json.loads(json_match.group(1))
        else:
            # å°è¯•ç›´æ¥è§£æ
            data = json.loads(ai_response)

        return StrategyInsights(**data)
```

---

### 6. æŠ¥å‘Šç”Ÿæˆæ¨¡å— (ReportGenerator)

**èŒè´£**: ç”Ÿæˆå¯è§†åŒ–å›¾è¡¨å’Œæ–‡å­—æŠ¥å‘Š

**æŠ¥å‘Šç±»å‹**:

1. **æ–‡å­—æŠ¥å‘Š** (Markdown/HTML)
2. **æ•°æ®å›¾è¡¨** (Matplotlib/Plotly)
3. **PDF æŠ¥å‘Š** (WeasyPrint)
4. **äº¤äº’å¼ä»ªè¡¨ç›˜** (Streamlit)

```python
class ReportGenerator:
    """æŠ¥å‘Šç”Ÿæˆå™¨"""

    def generate_full_report(
        self,
        account_data: AccountData,
        timeline: Timeline,
        stages: List[Stage],
        viral_posts: List[ViralPost],
        insights: StrategyInsights
    ) -> Report:
        """ç”Ÿæˆå®Œæ•´æŠ¥å‘Š"""

        report = Report()

        # 1. æ¦‚è§ˆéƒ¨åˆ†
        report.add_section("æ¦‚è§ˆ", self._generate_overview(account_data, stages))

        # 2. æ—¶é—´çº¿å¯è§†åŒ–
        report.add_chart("ç²‰ä¸å¢é•¿æ›²çº¿", self._plot_follower_growth(timeline))
        report.add_chart("äº’åŠ¨æ•°æ®è¶‹åŠ¿", self._plot_engagement_trend(timeline))

        # 3. é˜¶æ®µåˆ†æ
        for stage in stages:
            report.add_section(
                f"é˜¶æ®µåˆ†æï¼š{stage.name.value}",
                self._generate_stage_analysis(stage)
            )

        # 4. çˆ†æ¬¾åˆ†æ
        report.add_section("çˆ†æ¬¾å†…å®¹åˆ†æ", self._generate_viral_analysis(viral_posts))
        report.add_chart("çˆ†æ¬¾ç‰¹å¾é›·è¾¾å›¾", self._plot_viral_features(viral_posts))

        # 5. AI æ´å¯Ÿ
        report.add_section("ç­–ç•¥æ´å¯Ÿ", self._format_insights(insights))

        # 6. å¯å¤åˆ¶å»ºè®®
        report.add_section("å¯å¤åˆ¶å»ºè®®", self._format_actionable_tips(insights.actionable_tips))

        return report

    def _plot_follower_growth(self, timeline: Timeline) -> Figure:
        """ç»˜åˆ¶ç²‰ä¸å¢é•¿æ›²çº¿"""
        fig, ax = plt.subplots(figsize=(12, 6))

        dates = [p.date for p in timeline]
        followers = [p.estimated_followers for p in timeline]

        ax.plot(dates, followers, linewidth=2, color='#FF2442')
        ax.fill_between(dates, followers, alpha=0.3, color='#FF2442')

        # æ ‡æ³¨çˆ†æ¬¾ç‚¹
        for p in timeline:
            if hasattr(p, 'is_viral') and p.is_viral:
                ax.scatter(p.date, p.estimated_followers,
                          s=200, color='#FFD700', marker='*',
                          edgecolors='red', linewidths=2)
                ax.annotate('ğŸ”¥ çˆ†æ¬¾', xy=(p.date, p.estimated_followers),
                           xytext=(10, 10), textcoords='offset points')

        ax.set_title('ç²‰ä¸å¢é•¿æ›²çº¿', fontsize=16, fontweight='bold')
        ax.set_xlabel('æ—¶é—´', fontsize=12)
        ax.set_ylabel('ç²‰ä¸æ•°', fontsize=12)
        ax.grid(alpha=0.3)

        return fig

    def _generate_overview(self, account_data: AccountData, stages: List[Stage]) -> str:
        """ç”Ÿæˆæ¦‚è§ˆæ–‡æœ¬"""
        return f"""
## è´¦å·æ¦‚è§ˆ

**è´¦å·åç§°**: {account_data.profile.nickname}

**èµ·å·å‘¨æœŸ**: {stages[0].start_date.strftime('%Y-%m-%d')} ~ {stages[-1].end_date.strftime('%Y-%m-%d')} ({sum(s.duration_days for s in stages)}å¤©)

**ç²‰ä¸å¢é•¿**: 0 â†’ {account_data.profile.followers:,}

**å‘å¸–æ€»æ•°**: {len(account_data.posts)}

**æ€»è·èµæ•°**: {sum(p.likes for p in account_data.posts):,}

**çˆ†æ¬¾æ•°é‡**: {len([p for p in account_data.posts if p.likes > np.mean([p.likes for p in account_data.posts]) * 5])}

**å¹³å‡å‘å¸–**: {len(account_data.posts) / sum(s.duration_days for s in stages):.1f} ç¯‡/å¤©

**ä¸»è¦èµ›é“**: {', '.join(account_data.main_topics[:3])}
"""
```

---

## æ•°æ®æ¨¡å‹

### æ ¸å¿ƒæ•°æ®ç»“æ„

```python
from dataclasses import dataclass
from datetime import datetime
from typing import List, Optional
from enum import Enum

@dataclass
class UserProfile:
    """ç”¨æˆ·æ¡£æ¡ˆ"""
    user_id: str
    nickname: str
    bio: str
    followers: int
    total_likes: int
    total_collects: int
    avatar_url: str

@dataclass
class Post:
    """å¸–å­åŸºæœ¬ä¿¡æ¯"""
    post_id: str
    url: str
    title: str
    content: str
    content_type: str  # "å›¾æ–‡" | "è§†é¢‘"
    images: List[str]
    publish_time: datetime
    likes: int
    comments: int
    collects: int
    topics: List[str]  # è¯é¢˜æ ‡ç­¾

@dataclass
class PostDetail(Post):
    """å¸–å­è¯¦ç»†ä¿¡æ¯"""
    top_comments: List[dict]
    view_count: Optional[int]
    share_count: Optional[int]

@dataclass
class TimelinePoint:
    """æ—¶é—´çº¿æ•°æ®ç‚¹"""
    date: datetime
    post_index: int
    total_posts: int
    cumulative_likes: int
    avg_likes: float
    estimated_followers: int
    post: Post

@dataclass
class Breakpoint:
    """å¢é•¿æ‹ç‚¹"""
    index: int
    point: TimelinePoint
    growth_rate: float

@dataclass
class StageMetrics:
    """é˜¶æ®µæŒ‡æ ‡"""
    total_posts: int
    post_frequency: float
    avg_likes: float
    avg_comments: float
    avg_collects: float
    follower_growth: int
    content_types: dict  # {"å›¾æ–‡": 0.7, "è§†é¢‘": 0.3}
    popular_topics: List[str]
    posting_times: dict  # {"morning": 0.2, "afternoon": 0.3, ...}

@dataclass
class Stage:
    """æˆé•¿é˜¶æ®µ"""
    name: str  # GrowthStage enum
    start_date: datetime
    end_date: datetime
    duration_days: int
    posts: List[Post]
    metrics: StageMetrics

@dataclass
class ViralFeatures:
    """çˆ†æ¬¾ç‰¹å¾"""
    title_pattern: dict
    content_type: str
    image_count: int
    word_count: int
    topics: List[str]
    publish_time: datetime
    day_of_week: str
    hour_of_day: int

@dataclass
class ViralPost:
    """çˆ†æ¬¾å¸–å­"""
    post: Post
    viral_score: float
    outperform_rate: float  # è¶…è¶Šå¹³å‡å€æ•°
    features: ViralFeatures

@dataclass
class StrategyInsights:
    """ç­–ç•¥æ´å¯Ÿ"""
    core_findings: List[str]
    stage_analysis: dict
    viral_patterns: dict
    actionable_tips: List[dict]

@dataclass
class Report:
    """åˆ†ææŠ¥å‘Š"""
    sections: List[dict]  # {"title": str, "content": str}
    charts: List[dict]    # {"title": str, "figure": Figure}

    def add_section(self, title: str, content: str):
        self.sections.append({"title": title, "content": content})

    def add_chart(self, title: str, figure):
        self.charts.append({"title": title, "figure": figure})

    def to_html(self) -> str:
        """å¯¼å‡º HTML"""
        pass

    def to_pdf(self) -> bytes:
        """å¯¼å‡º PDF"""
        pass

    def to_json(self) -> str:
        """å¯¼å‡º JSON"""
        pass
```

### æ•°æ®åº“è¡¨è®¾è®¡

```sql
-- è´¦å·è¡¨
CREATE TABLE accounts (
    id SERIAL PRIMARY KEY,
    user_id VARCHAR(100) UNIQUE NOT NULL,
    nickname VARCHAR(200),
    bio TEXT,
    followers INTEGER,
    total_likes INTEGER,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- å¸–å­è¡¨
CREATE TABLE posts (
    id SERIAL PRIMARY KEY,
    post_id VARCHAR(100) UNIQUE NOT NULL,
    account_id INTEGER REFERENCES accounts(id),
    title VARCHAR(500),
    content TEXT,
    content_type VARCHAR(50),
    publish_time TIMESTAMP,
    likes INTEGER,
    comments INTEGER,
    collects INTEGER,
    topics JSONB,  -- è¯é¢˜æ ‡ç­¾æ•°ç»„
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- åˆ†æä»»åŠ¡è¡¨
CREATE TABLE analysis_tasks (
    id SERIAL PRIMARY KEY,
    account_id INTEGER REFERENCES accounts(id),
    status VARCHAR(50),  -- pending/running/completed/failed
    progress INTEGER DEFAULT 0,
    result JSONB,  -- åˆ†æç»“æœ
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    completed_at TIMESTAMP
);

-- çˆ†æ¬¾å¸–å­è¡¨
CREATE TABLE viral_posts (
    id SERIAL PRIMARY KEY,
    post_id INTEGER REFERENCES posts(id),
    viral_score FLOAT,
    outperform_rate FLOAT,
    features JSONB,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- æˆé•¿é˜¶æ®µè¡¨
CREATE TABLE growth_stages (
    id SERIAL PRIMARY KEY,
    account_id INTEGER REFERENCES accounts(id),
    stage_name VARCHAR(50),
    start_date TIMESTAMP,
    end_date TIMESTAMP,
    duration_days INTEGER,
    metrics JSONB,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- ç´¢å¼•
CREATE INDEX idx_posts_account_id ON posts(account_id);
CREATE INDEX idx_posts_publish_time ON posts(publish_time);
CREATE INDEX idx_viral_posts_score ON viral_posts(viral_score DESC);
```

---

## æŠ€æœ¯æ ˆ

### åç«¯æŠ€æœ¯æ ˆ

| ç±»åˆ« | æŠ€æœ¯é€‰å‹ | è¯´æ˜ |
|-----|---------|------|
| **ç¼–ç¨‹è¯­è¨€** | Python 3.11+ | å¼‚æ­¥æ”¯æŒã€ç±»å‹æ³¨è§£ |
| **Web æ¡†æ¶** | FastAPI | é«˜æ€§èƒ½ã€å¼‚æ­¥ã€è‡ªåŠ¨æ–‡æ¡£ |
| **æ•°æ®éªŒè¯** | Pydantic | æ•°æ®æ¨¡å‹å’ŒéªŒè¯ |
| **æ•°æ®æ”¶é›†** | browser-use + Playwright | æµè§ˆå™¨è‡ªåŠ¨åŒ– |
| **AI åˆ†æ** | Google Gemini (LangChain) | å¤§è¯­è¨€æ¨¡å‹ |
| **æ•°æ®åº“** | PostgreSQL | å…³ç³»å‹æ•°æ®åº“ |
| **ç¼“å­˜** | Redis | ä»»åŠ¡é˜Ÿåˆ—ã€æ•°æ®ç¼“å­˜ |
| **ä»»åŠ¡é˜Ÿåˆ—** | Celery | å¼‚æ­¥ä»»åŠ¡å¤„ç† |
| **æ•°æ®åˆ†æ** | pandas + numpy | æ•°æ®å¤„ç† |
| **å¯è§†åŒ–** | matplotlib + plotly | å›¾è¡¨ç”Ÿæˆ |
| **å˜ç‚¹æ£€æµ‹** | ruptures | æ—¶é—´åºåˆ—åˆ†æ |
| **PDF ç”Ÿæˆ** | WeasyPrint | HTML â†’ PDF |

### å‰ç«¯æŠ€æœ¯æ ˆï¼ˆå¯é€‰ï¼‰

| ç±»åˆ« | æŠ€æœ¯é€‰å‹ | è¯´æ˜ |
|-----|---------|------|
| **æ¡†æ¶** | React 18 + TypeScript | UI æ¡†æ¶ |
| **çŠ¶æ€ç®¡ç†** | Zustand | è½»é‡çŠ¶æ€ç®¡ç† |
| **UI ç»„ä»¶** | Ant Design / shadcn/ui | UI åº“ |
| **å›¾è¡¨** | ECharts / Recharts | æ•°æ®å¯è§†åŒ– |
| **æ„å»ºå·¥å…·** | Vite | å¿«é€Ÿæ„å»º |

### éƒ¨ç½²æŠ€æœ¯æ ˆ

| ç±»åˆ« | æŠ€æœ¯é€‰å‹ | è¯´æ˜ |
|-----|---------|------|
| **å®¹å™¨åŒ–** | Docker + Docker Compose | å®¹å™¨ç¼–æ’ |
| **åå‘ä»£ç†** | Nginx | è´Ÿè½½å‡è¡¡ã€é™æ€æ–‡ä»¶ |
| **è¿›ç¨‹ç®¡ç†** | Supervisor | è¿›ç¨‹å®ˆæŠ¤ |
| **ç›‘æ§** | Prometheus + Grafana | æ€§èƒ½ç›‘æ§ |

---

## æ•°æ®æµè½¬

### å®Œæ•´æ•°æ®æµç¨‹å›¾

```
ç”¨æˆ·è¾“å…¥
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ä»»åŠ¡åˆ›å»º                     â”‚
â”‚ - éªŒè¯è´¦å· URL                  â”‚
â”‚ - åˆ›å»ºåˆ†æä»»åŠ¡                  â”‚
â”‚ - è¿”å›ä»»åŠ¡ ID                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. æ•°æ®æ”¶é›†ï¼ˆCelery å¼‚æ­¥ï¼‰      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ 2.1 æ”¶é›†è´¦å·ä¿¡æ¯        â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ 2.2 æ”¶é›†æ‰€æœ‰å¸–å­åˆ—è¡¨    â”‚    â”‚
â”‚ â”‚ ï¼ˆæ»šåŠ¨åŠ è½½ï¼‰            â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ 2.3 å¹¶å‘æ”¶é›†å¸–å­è¯¦æƒ…    â”‚    â”‚
â”‚ â”‚ ï¼ˆSemaphore æ§åˆ¶å¹¶å‘ï¼‰  â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚ â†“                               â”‚
â”‚ ä¿å­˜åˆ°æ•°æ®åº“ + æ›´æ–°ä»»åŠ¡è¿›åº¦     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. æ•°æ®åˆ†æ                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ 3.1 æ„å»ºæ—¶é—´çº¿          â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ 3.2 æ£€æµ‹å¢é•¿æ‹ç‚¹        â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ 3.3 åˆ’åˆ†æˆé•¿é˜¶æ®µ        â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ 3.4 è¯†åˆ«çˆ†æ¬¾å†…å®¹        â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. AI åˆ†æï¼ˆGeminiï¼‰            â”‚
â”‚ - åˆ†æå„é˜¶æ®µç­–ç•¥                â”‚
â”‚ - æå–çˆ†æ¬¾è§„å¾‹                  â”‚
â”‚ - ç”Ÿæˆå¯æ‰§è¡Œå»ºè®®                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. æŠ¥å‘Šç”Ÿæˆ                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ 5.1 ç”Ÿæˆæ–‡å­—æŠ¥å‘Š        â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ 5.2 ç»˜åˆ¶æ•°æ®å›¾è¡¨        â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ 5.3 å¯¼å‡ºå¤šç§æ ¼å¼        â”‚    â”‚
â”‚ â”‚ (HTML/PDF/JSON)         â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
è¿”å›ç»™ç”¨æˆ·
```

### æ•°æ®ç¼“å­˜ç­–ç•¥

```python
# ç¼“å­˜ç­–ç•¥
CACHE_CONFIG = {
    # è´¦å·ä¿¡æ¯ç¼“å­˜ 24 å°æ—¶
    "account_profile": {
        "ttl": 86400,
        "key_pattern": "account:{user_id}:profile"
    },

    # å¸–å­åˆ—è¡¨ç¼“å­˜ 12 å°æ—¶
    "posts_list": {
        "ttl": 43200,
        "key_pattern": "account:{user_id}:posts"
    },

    # å¸–å­è¯¦æƒ…ç¼“å­˜ 7 å¤©ï¼ˆä¸å¸¸å˜ï¼‰
    "post_detail": {
        "ttl": 604800,
        "key_pattern": "post:{post_id}:detail"
    },

    # åˆ†æç»“æœç¼“å­˜ 1 å°æ—¶ï¼ˆå¯èƒ½é‡æ–°åˆ†æï¼‰
    "analysis_result": {
        "ttl": 3600,
        "key_pattern": "account:{user_id}:analysis"
    }
}
```

---

## API è®¾è®¡

### RESTful API ç«¯ç‚¹

```python
# ============================================================
# è´¦å·åˆ†æ API
# ============================================================

@app.post("/api/v1/analysis/create")
async def create_analysis_task(request: CreateAnalysisRequest) -> TaskResponse:
    """åˆ›å»ºåˆ†æä»»åŠ¡"""
    # POST /api/v1/analysis/create
    # Body: {"user_url": "https://www.xiaohongshu.com/user/xxxxx"}
    # Response: {"task_id": "uuid", "status": "pending"}

@app.get("/api/v1/analysis/{task_id}/status")
async def get_task_status(task_id: str) -> TaskStatusResponse:
    """æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€"""
    # GET /api/v1/analysis/{task_id}/status
    # Response: {"task_id": "uuid", "status": "running", "progress": 45}

@app.get("/api/v1/analysis/{task_id}/result")
async def get_analysis_result(task_id: str) -> AnalysisResultResponse:
    """è·å–åˆ†æç»“æœ"""
    # GET /api/v1/analysis/{task_id}/result
    # Response: {...å®Œæ•´åˆ†æç»“æœ...}

@app.get("/api/v1/analysis/{task_id}/report")
async def download_report(
    task_id: str,
    format: str = "html"  # html | pdf | json
) -> FileResponse:
    """ä¸‹è½½æŠ¥å‘Š"""
    # GET /api/v1/analysis/{task_id}/report?format=pdf

# ============================================================
# è´¦å·æ•°æ® API
# ============================================================

@app.get("/api/v1/accounts/{user_id}")
async def get_account_info(user_id: str) -> AccountResponse:
    """è·å–è´¦å·ä¿¡æ¯"""

@app.get("/api/v1/accounts/{user_id}/posts")
async def get_account_posts(
    user_id: str,
    offset: int = 0,
    limit: int = 20,
    sort_by: str = "publish_time"
) -> PostsResponse:
    """è·å–è´¦å·å¸–å­åˆ—è¡¨"""

@app.get("/api/v1/accounts/{user_id}/viral-posts")
async def get_viral_posts(user_id: str) -> ViralPostsResponse:
    """è·å–çˆ†æ¬¾å¸–å­"""

@app.get("/api/v1/accounts/{user_id}/timeline")
async def get_timeline(user_id: str) -> TimelineResponse:
    """è·å–æ—¶é—´çº¿æ•°æ®"""

# ============================================================
# å¯¹æ¯”åˆ†æ API
# ============================================================

@app.post("/api/v1/comparison/create")
async def create_comparison(request: ComparisonRequest) -> ComparisonResponse:
    """åˆ›å»ºå¯¹æ¯”åˆ†æ"""
    # Body: {"user_ids": ["user1", "user2", "user3"]}

@app.get("/api/v1/comparison/{comparison_id}")
async def get_comparison_result(comparison_id: str) -> ComparisonResultResponse:
    """è·å–å¯¹æ¯”ç»“æœ"""
```

### è¯·æ±‚/å“åº”æ¨¡å‹

```python
from pydantic import BaseModel, HttpUrl
from typing import List, Optional
from datetime import datetime

# ============================================================
# è¯·æ±‚æ¨¡å‹
# ============================================================

class CreateAnalysisRequest(BaseModel):
    user_url: HttpUrl
    options: Optional[dict] = None  # åˆ†æé€‰é¡¹

class ComparisonRequest(BaseModel):
    user_ids: List[str]
    comparison_type: str = "growth_path"  # growth_path | viral_features

# ============================================================
# å“åº”æ¨¡å‹
# ============================================================

class TaskResponse(BaseModel):
    task_id: str
    status: str  # pending | running | completed | failed
    created_at: datetime

class TaskStatusResponse(BaseModel):
    task_id: str
    status: str
    progress: int  # 0-100
    message: Optional[str]
    estimated_time: Optional[int]  # é¢„è®¡å‰©ä½™ç§’æ•°

class AnalysisResultResponse(BaseModel):
    task_id: str
    account: AccountInfo
    timeline: TimelineData
    stages: List[StageData]
    viral_posts: List[ViralPostData]
    insights: InsightsData
    created_at: datetime

class AccountInfo(BaseModel):
    user_id: str
    nickname: str
    followers: int
    total_posts: int
    total_likes: int

class StageData(BaseModel):
    name: str
    start_date: datetime
    end_date: datetime
    duration_days: int
    metrics: dict

class ViralPostData(BaseModel):
    post_id: str
    title: str
    likes: int
    viral_score: float
    features: dict

class InsightsData(BaseModel):
    core_findings: List[str]
    stage_analysis: dict
    viral_patterns: dict
    actionable_tips: List[dict]
```

---

## ç®—æ³•è®¾è®¡

### 1. ç²‰ä¸æ•°æ¨ç®—ç®—æ³•

**é—®é¢˜**: å°çº¢ä¹¦ä¸å±•ç¤ºå†å²ç²‰ä¸æ•°ï¼Œéœ€è¦é€šè¿‡äº’åŠ¨æ•°æ®æ¨ç®—

**ç®—æ³•**:
```python
def estimate_followers_advanced(posts: List[Post], current_followers: int) -> List[int]:
    """
    é«˜çº§ç²‰ä¸æ•°æ¨ç®—ç®—æ³•

    åŸç†:
    1. å·²çŸ¥æœ€æ–°ç²‰ä¸æ•°
    2. æ ¹æ®äº’åŠ¨ç‡åæ¨å†å²ç²‰ä¸æ•°
    3. ä½¿ç”¨å¹³æ»‘ç®—æ³•ç¡®ä¿å•è°ƒæ€§
    """

    # 1. è®¡ç®—å½“å‰äº’åŠ¨ç‡
    recent_posts = posts[-10:]  # æœ€è¿‘10ç¯‡
    total_engagement = sum(p.likes + p.comments + p.collects for p in recent_posts)
    current_engagement_rate = total_engagement / (len(recent_posts) * current_followers)

    # 2. åå‘æ¨ç®—
    estimated_followers = []

    for i, post in enumerate(posts):
        # åŠ¨æ€äº’åŠ¨ç‡ï¼ˆæ—©æœŸé«˜ï¼ŒåæœŸä½ï¼‰
        progress = i / len(posts)
        engagement_rate = current_engagement_rate * (1 + (1 - progress) * 2)

        # æ¨ç®—ç²‰ä¸æ•°
        post_engagement = post.likes + post.comments + post.collects
        followers = int(post_engagement / engagement_rate)

        # ç¡®ä¿å•è°ƒé€’å¢
        if estimated_followers and followers < estimated_followers[-1]:
            followers = estimated_followers[-1]

        estimated_followers.append(followers)

    # 3. å¹³æ»‘å¤„ç†ï¼ˆç§»åŠ¨å¹³å‡ï¼‰
    smoothed = []
    window = 5
    for i in range(len(estimated_followers)):
        start = max(0, i - window)
        end = min(len(estimated_followers), i + window + 1)
        smoothed.append(int(np.mean(estimated_followers[start:end])))

    # 4. ç¼©æ”¾åˆ°å½“å‰ç²‰ä¸æ•°
    scale = current_followers / smoothed[-1]
    final = [int(f * scale) for f in smoothed]

    return final
```

### 2. å¢é•¿æ‹ç‚¹æ£€æµ‹ç®—æ³•

**é—®é¢˜**: è‡ªåŠ¨è¯†åˆ«è´¦å·æˆé•¿çš„å…³é”®è½¬æŠ˜ç‚¹

**ç®—æ³•**: PELT (Pruned Exact Linear Time)

```python
import ruptures as rpt

def detect_breakpoints(timeline: Timeline) -> List[Breakpoint]:
    """
    ä½¿ç”¨ PELT ç®—æ³•æ£€æµ‹å¢é•¿æ‹ç‚¹

    PELT æ˜¯ä¸€ç§é«˜æ•ˆçš„å˜ç‚¹æ£€æµ‹ç®—æ³•ï¼Œå¯ä»¥åœ¨çº¿æ€§æ—¶é—´å†…
    æ‰¾åˆ°æ—¶é—´åºåˆ—ä¸­çš„æ˜¾è‘—å˜åŒ–ç‚¹
    """

    # 1. æå–ç²‰ä¸æ•°åºåˆ—
    follower_signal = np.array([p.estimated_followers for p in timeline])

    # 2. æ•°æ®é¢„å¤„ç†ï¼ˆå¯¹æ•°å˜æ¢ï¼Œä½¿å¢é•¿æ›´çº¿æ€§ï¼‰
    log_signal = np.log1p(follower_signal)

    # 3. PELT å˜ç‚¹æ£€æµ‹
    model = rpt.Pelt(model="rbf", min_size=5, jump=1).fit(log_signal)

    # pen å‚æ•°æ§åˆ¶æ•æ„Ÿåº¦ï¼ˆè¶Šå¤§è¶Šä¸æ•æ„Ÿï¼‰
    # ç»éªŒå€¼: len(signal) * 0.1
    penalty = len(log_signal) * 0.1
    breakpoint_indices = model.predict(pen=penalty)

    # 4. ç§»é™¤æœ«å°¾çš„è¾¹ç•Œç‚¹
    if breakpoint_indices[-1] == len(timeline):
        breakpoint_indices = breakpoint_indices[:-1]

    # 5. è®¡ç®—å¢é•¿ç‡
    breakpoints = []
    for idx in breakpoint_indices:
        if idx > 0:
            prev_followers = timeline[idx-1].estimated_followers
            curr_followers = timeline[idx].estimated_followers
            growth_rate = (curr_followers - prev_followers) / prev_followers

            breakpoints.append(Breakpoint(
                index=idx,
                point=timeline[idx],
                growth_rate=growth_rate
            ))

    return breakpoints
```

### 3. çˆ†æ¬¾è¯†åˆ«ç®—æ³•

**é—®é¢˜**: è¯†åˆ«å“ªäº›å†…å®¹æ˜¯çœŸæ­£çš„çˆ†æ¬¾

**ç®—æ³•**: Z-Score + ç»¼åˆæŒ‡æ ‡

```python
def detect_viral_posts_advanced(posts: List[Post]) -> List[ViralPost]:
    """
    é«˜çº§çˆ†æ¬¾è¯†åˆ«ç®—æ³•

    ä½¿ç”¨å¤šç»´åº¦æŒ‡æ ‡:
    1. Z-Score (æ ‡å‡†åˆ†)
    2. æ”¶è—ç‡
    3. è¯„è®ºç‡
    4. å¢é•¿é€Ÿåº¦
    """

    # 1. è®¡ç®—å„ç»´åº¦çš„ Z-Score
    likes_array = np.array([p.likes for p in posts])
    likes_zscore = (likes_array - likes_array.mean()) / likes_array.std()

    collects_array = np.array([p.collects for p in posts])
    collects_zscore = (collects_array - collects_array.mean()) / collects_array.std()

    # 2. è®¡ç®—ç»¼åˆçˆ†æ¬¾æŒ‡æ•°
    viral_posts = []

    for i, post in enumerate(posts):
        # æ”¶è—ç‡ï¼ˆåæ˜ å†…å®¹ä»·å€¼ï¼‰
        collect_rate = post.collects / post.likes if post.likes > 0 else 0

        # è¯„è®ºç‡ï¼ˆåæ˜ äº’åŠ¨æ€§ï¼‰
        comment_rate = post.comments / post.likes if post.likes > 0 else 0

        # ç»¼åˆçˆ†æ¬¾æŒ‡æ•°
        viral_score = (
            likes_zscore[i] * 0.4 +      # ç»å¯¹çƒ­åº¦
            collect_rate * 100 * 0.3 +   # æ”¶è—ä»·å€¼
            comment_rate * 100 * 0.2 +   # äº’åŠ¨çƒ­åº¦
            (1 if likes_zscore[i] > 2 else 0) * 0.1  # çªç ´æ€§
        )

        # çˆ†æ¬¾é˜ˆå€¼: viral_score > 5
        if viral_score > 5:
            viral_posts.append(ViralPost(
                post=post,
                viral_score=viral_score,
                outperform_rate=post.likes / likes_array.mean(),
                features=extract_viral_features(post)
            ))

    return sorted(viral_posts, key=lambda v: v.viral_score, reverse=True)
```

### 4. å†…å®¹ç­–ç•¥æ¼”å˜åˆ†æ

**é—®é¢˜**: è¯†åˆ«å†…å®¹ç­–ç•¥çš„å˜åŒ–

**ç®—æ³•**: æ»‘åŠ¨çª—å£ + ä¸»é¢˜èšç±»

```python
from sklearn.feature_extraction.text import TfidfVectorizer
from sklearn.cluster import KMeans

def analyze_content_strategy_evolution(posts: List[Post], window_size: int = 10):
    """
    åˆ†æå†…å®¹ç­–ç•¥æ¼”å˜

    ä½¿ç”¨æ»‘åŠ¨çª—å£åˆ†æä¸åŒé˜¶æ®µçš„å†…å®¹ä¸»é¢˜å˜åŒ–
    """

    strategy_timeline = []

    for i in range(0, len(posts), window_size):
        window_posts = posts[i:i+window_size]

        # 1. æå–æ–‡æœ¬ï¼ˆæ ‡é¢˜ + è¯é¢˜ï¼‰
        texts = [f"{p.title} {' '.join(p.topics)}" for p in window_posts]

        # 2. TF-IDF ç‰¹å¾æå–
        vectorizer = TfidfVectorizer(max_features=20)
        tfidf_matrix = vectorizer.fit_transform(texts)

        # 3. æå–å…³é”®è¯
        feature_names = vectorizer.get_feature_names_out()
        avg_tfidf = tfidf_matrix.mean(axis=0).A1
        top_keywords = [feature_names[i] for i in avg_tfidf.argsort()[-5:][::-1]]

        # 4. å†…å®¹ç±»å‹åˆ†å¸ƒ
        content_types = {}
        for p in window_posts:
            content_types[p.content_type] = content_types.get(p.content_type, 0) + 1

        # 5. è®°å½•ç­–ç•¥
        strategy_timeline.append({
            "period": f"ç¬¬{i+1}-{i+window_size}ç¯‡",
            "keywords": top_keywords,
            "content_types": content_types,
            "avg_likes": np.mean([p.likes for p in window_posts]),
            "post_frequency": len(window_posts) / window_size
        })

    return strategy_timeline
```

---

## éƒ¨ç½²æ–¹æ¡ˆ

### Docker Compose éƒ¨ç½²

```yaml
# docker-compose.yml
version: '3.8'

services:
  # ============================================================
  # åç«¯ API æœåŠ¡
  # ============================================================
  api:
    build: ./backend
    ports:
      - "8000:8000"
    environment:
      - DATABASE_URL=postgresql://user:pass@db:5432/growth_analyzer
      - REDIS_URL=redis://redis:6379/0
      - GEMINI_API_KEY=${GEMINI_API_KEY}
    depends_on:
      - db
      - redis
    volumes:
      - ./backend:/app
    command: uvicorn main:app --host 0.0.0.0 --port 8000 --reload

  # ============================================================
  # Celery Workerï¼ˆå¼‚æ­¥ä»»åŠ¡ï¼‰
  # ============================================================
  worker:
    build: ./backend
    environment:
      - DATABASE_URL=postgresql://user:pass@db:5432/growth_analyzer
      - REDIS_URL=redis://redis:6379/0
      - GEMINI_API_KEY=${GEMINI_API_KEY}
    depends_on:
      - db
      - redis
    volumes:
      - ./backend:/app
    command: celery -A tasks worker --loglevel=info --concurrency=4

  # ============================================================
  # PostgreSQL æ•°æ®åº“
  # ============================================================
  db:
    image: postgres:15-alpine
    environment:
      - POSTGRES_USER=user
      - POSTGRES_PASSWORD=pass
      - POSTGRES_DB=growth_analyzer
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5432:5432"

  # ============================================================
  # Redisï¼ˆç¼“å­˜ + ä»»åŠ¡é˜Ÿåˆ—ï¼‰
  # ============================================================
  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data

  # ============================================================
  # Nginxï¼ˆåå‘ä»£ç†ï¼‰
  # ============================================================
  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
      - ./frontend/dist:/usr/share/nginx/html
    depends_on:
      - api

  # ============================================================
  # å‰ç«¯ï¼ˆå¯é€‰ï¼‰
  # ============================================================
  frontend:
    build: ./frontend
    ports:
      - "3000:3000"
    volumes:
      - ./frontend:/app
      - /app/node_modules
    command: npm run dev

volumes:
  postgres_data:
  redis_data:
```

### ç¯å¢ƒå˜é‡é…ç½®

```bash
# .env
GEMINI_API_KEY=your_gemini_api_key
DATABASE_URL=postgresql://user:pass@localhost:5432/growth_analyzer
REDIS_URL=redis://localhost:6379/0

# å¯é€‰ï¼šBrowser Use Cloud
BROWSER_USE_API_KEY=your_browser_use_key
```

### ä¸€é”®å¯åŠ¨è„šæœ¬

```bash
#!/bin/bash
# deploy.sh

echo "ğŸš€ å¯åŠ¨å°çº¢ä¹¦èµ·å·åˆ†æå·¥å…·..."

# 1. æ£€æŸ¥ç¯å¢ƒå˜é‡
if [ ! -f .env ]; then
    echo "âŒ ç¼ºå°‘ .env æ–‡ä»¶ï¼Œè¯·å…ˆé…ç½®"
    exit 1
fi

# 2. æ„å»ºé•œåƒ
echo "ğŸ“¦ æ„å»º Docker é•œåƒ..."
docker-compose build

# 3. å¯åŠ¨æœåŠ¡
echo "ğŸ”§ å¯åŠ¨æœåŠ¡..."
docker-compose up -d

# 4. ç­‰å¾…æ•°æ®åº“å°±ç»ª
echo "â³ ç­‰å¾…æ•°æ®åº“åˆå§‹åŒ–..."
sleep 5

# 5. è¿è¡Œæ•°æ®åº“è¿ç§»
echo "ğŸ—„ï¸ è¿è¡Œæ•°æ®åº“è¿ç§»..."
docker-compose exec api alembic upgrade head

# 6. æ˜¾ç¤ºçŠ¶æ€
echo "âœ… æœåŠ¡å¯åŠ¨å®Œæˆï¼"
echo ""
echo "ğŸ“ è®¿é—®åœ°å€:"
echo "   - API æ–‡æ¡£: http://localhost:8000/docs"
echo "   - Web ç•Œé¢: http://localhost:80"
echo ""
echo "ğŸ“Š æŸ¥çœ‹æ—¥å¿—:"
echo "   docker-compose logs -f"
```

---

## å¼€å‘è·¯çº¿å›¾

### MVP ç‰ˆæœ¬ï¼ˆ1-2å‘¨ï¼‰

**æ ¸å¿ƒåŠŸèƒ½**:
- âœ… æ•°æ®æ”¶é›†ï¼ˆåŸºäºç°æœ‰ä»£ç ï¼‰
- âœ… æ—¶é—´åºåˆ—åˆ†æ
- âœ… é˜¶æ®µåˆ’åˆ†
- âœ… çˆ†æ¬¾è¯†åˆ«
- âœ… CLI å·¥å…·
- âœ… JSON/HTML æŠ¥å‘Šå¯¼å‡º

**æŠ€æœ¯å®ç°**:
```
Week 1:
- Day 1-2: æ•°æ®æ”¶é›†æ¨¡å—ï¼ˆå¤ç”¨ç°æœ‰ä»£ç ï¼‰
- Day 3-4: æ—¶é—´åºåˆ—åˆ†æ + é˜¶æ®µåˆ’åˆ†
- Day 5-6: çˆ†æ¬¾è¯†åˆ«ç®—æ³•
- Day 7: CLI å·¥å…· + åŸºç¡€æŠ¥å‘Š

Week 2:
- Day 1-2: AI åˆ†æé›†æˆï¼ˆGeminiï¼‰
- Day 3-4: æŠ¥å‘Šä¼˜åŒ–ï¼ˆå›¾è¡¨ + æ–‡å­—ï¼‰
- Day 5: æµ‹è¯•å’Œä¼˜åŒ–
- Day 6-7: æ–‡æ¡£å’Œå‘å¸ƒ
```

### V1.0 ç‰ˆæœ¬ï¼ˆ3-4å‘¨ï¼‰

**æ–°å¢åŠŸèƒ½**:
- âœ… FastAPI REST API
- âœ… PostgreSQL æ•°æ®æŒä¹…åŒ–
- âœ… Redis ç¼“å­˜
- âœ… Celery å¼‚æ­¥ä»»åŠ¡
- âœ… Web UIï¼ˆç®€å•ç‰ˆï¼‰
- âœ… PDF æŠ¥å‘Šå¯¼å‡º

### V2.0 ç‰ˆæœ¬ï¼ˆ2-3ä¸ªæœˆï¼‰

**æ–°å¢åŠŸèƒ½**:
- âœ… å¯¹æ¯”åˆ†æï¼ˆå¤šè´¦å·ï¼‰
- âœ… æ¡ˆä¾‹åº“ï¼ˆæ”¶å½•ä¼˜è´¨æ¡ˆä¾‹ï¼‰
- âœ… å®æ—¶è¿½è¸ªï¼ˆå®šæœŸæ›´æ–°æ•°æ®ï¼‰
- âœ… äº¤äº’å¼ä»ªè¡¨ç›˜
- âœ… ç”¨æˆ·ç³»ç»Ÿï¼ˆç™»å½•ã€æ”¶è—ï¼‰
- âœ… Chrome æ’ä»¶

### V3.0 ç‰ˆæœ¬ï¼ˆé•¿æœŸè§„åˆ’ï¼‰

**æ–°å¢åŠŸèƒ½**:
- âœ… å¤šå¹³å°æ”¯æŒï¼ˆæŠ–éŸ³ã€Bç«™ï¼‰
- âœ… ç­–ç•¥æ¨èå¼•æ“
- âœ… AI å†…å®¹ç”ŸæˆåŠ©æ‰‹
- âœ… å•†ä¸šåŒ–åŠŸèƒ½ï¼ˆä»˜è´¹æŠ¥å‘Šï¼‰

---

## æŠ€æœ¯æŒ‘æˆ˜å’Œè§£å†³æ–¹æ¡ˆ

### æŒ‘æˆ˜ 1: æ•°æ®é‡å¤§ï¼Œæ”¶é›†æ…¢

**é—®é¢˜**: ä¸€ä¸ªè´¦å·å¯èƒ½æœ‰å‡ ç™¾ç¯‡å¸–å­ï¼Œå…¨é‡æ”¶é›†è€—æ—¶é•¿

**è§£å†³æ–¹æ¡ˆ**:
1. **å¹¶å‘æ”¶é›†**: ä½¿ç”¨ asyncio + Semaphoreï¼ŒåŒæ—¶æ”¶é›†å¤šä¸ªå¸–å­
2. **å¢é‡æ›´æ–°**: åªæ”¶é›†æ–°å¢å¸–å­
3. **åå°ä»»åŠ¡**: Celery å¼‚æ­¥å¤„ç†ï¼Œç”¨æˆ·ä¸ç­‰å¾…
4. **è¿›åº¦åé¦ˆ**: WebSocket å®æ—¶æ¨é€è¿›åº¦

```python
# å¹¶å‘æ”¶é›†ç¤ºä¾‹
async def collect_posts_concurrent(posts: List[Post], max_concurrent=5):
    semaphore = asyncio.Semaphore(max_concurrent)

    async def fetch_with_limit(post):
        async with semaphore:
            return await collect_post_detail(post)

    tasks = [fetch_with_limit(p) for p in posts]
    results = await asyncio.gather(*tasks, return_exceptions=True)
    return results
```

### æŒ‘æˆ˜ 2: ç²‰ä¸æ•°æ— æ³•ç›´æ¥è·å–

**é—®é¢˜**: å°çº¢ä¹¦ä¸å±•ç¤ºå†å²ç²‰ä¸æ•°

**è§£å†³æ–¹æ¡ˆ**:
1. **äº’åŠ¨ç‡æ¨ç®—**: åŸºäºç‚¹èµ/è¯„è®ºæ•°åæ¨
2. **å¤šæ¬¡é‡‡æ ·**: å®šæœŸæ›´æ–°å½“å‰ç²‰ä¸æ•°ï¼Œæé«˜å‡†ç¡®æ€§
3. **æœºå™¨å­¦ä¹ **: è®­ç»ƒæ¨¡å‹é¢„æµ‹ç²‰ä¸æ•°
4. **ç½®ä¿¡åŒºé—´**: ç»™å‡ºç²‰ä¸æ•°èŒƒå›´è€Œéç»å¯¹å€¼

### æŒ‘æˆ˜ 3: åçˆ¬è™«é™åˆ¶

**é—®é¢˜**: é¢‘ç¹è¯·æ±‚ä¼šè¢«é™åˆ¶

**è§£å†³æ–¹æ¡ˆ**:
1. **é€Ÿç‡é™åˆ¶**: æ§åˆ¶è¯·æ±‚é¢‘ç‡ï¼ˆ2-3ç§’/æ¬¡ï¼‰
2. **æµè§ˆå™¨æŒ‡çº¹**: éšæœºåŒ– User-Agent
3. **ä»£ç†æ± **: è½®æ¢ IPï¼ˆå¯é€‰ï¼‰
4. **Browser Use Cloud**: ä½¿ç”¨å®˜æ–¹äº‘æµè§ˆå™¨æœåŠ¡

### æŒ‘æˆ˜ 4: AI åˆ†ææˆæœ¬

**é—®é¢˜**: Gemini API è°ƒç”¨æœ‰æˆæœ¬

**è§£å†³æ–¹æ¡ˆ**:
1. **æ‰¹é‡åˆ†æ**: ä¸€æ¬¡ API è°ƒç”¨åˆ†ææ‰€æœ‰é˜¶æ®µ
2. **ç»“æœç¼“å­˜**: ç›¸åŒè´¦å·ä¸é‡å¤åˆ†æ
3. **æœ¬åœ°æ¨¡å‹**: ç®€å•åˆ†æç”¨æœ¬åœ°æ¨¡å‹ï¼ˆå¯é€‰ï¼‰
4. **å…è´¹é¢åº¦**: Gemini æœ‰æ¯æ—¥å…è´¹é¢åº¦

---

## é™„å½•

### A. ä¾èµ–æ¸…å•

```txt
# requirements.txt

# Web æ¡†æ¶
fastapi==0.109.0
uvicorn[standard]==0.27.0
pydantic==2.5.0
pydantic-settings==2.1.0

# æ•°æ®æ”¶é›†
browser-use>=0.1.0
playwright==1.40.0

# AI æ¨¡å‹
langchain-google-genai==1.0.0
google-generativeai==0.3.0

# æ•°æ®åº“
sqlalchemy==2.0.25
psycopg2-binary==2.9.9
alembic==1.13.1

# ç¼“å­˜å’Œé˜Ÿåˆ—
redis==5.0.1
celery==5.3.6

# æ•°æ®åˆ†æ
pandas==2.1.4
numpy==1.26.3
ruptures==1.1.9  # å˜ç‚¹æ£€æµ‹
scikit-learn==1.4.0

# å¯è§†åŒ–
matplotlib==3.8.2
plotly==5.18.0
seaborn==0.13.1

# æŠ¥å‘Šç”Ÿæˆ
jinja2==3.1.3
weasyprint==60.2  # PDF ç”Ÿæˆ
markdown==3.5.1

# å·¥å…·
python-dotenv==1.0.0
click==8.1.7
httpx==0.26.0
```

### B. é¡¹ç›®ç»“æ„

```
growth-analyzer/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ main.py              # FastAPI å…¥å£
â”‚   â”‚   â”œâ”€â”€ config.py            # é…ç½®
â”‚   â”‚   â”œâ”€â”€ models/              # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ account.py
â”‚   â”‚   â”‚   â”œâ”€â”€ post.py
â”‚   â”‚   â”‚   â””â”€â”€ analysis.py
â”‚   â”‚   â”œâ”€â”€ api/                 # API è·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ analysis.py
â”‚   â”‚   â”‚   â”œâ”€â”€ accounts.py
â”‚   â”‚   â”‚   â””â”€â”€ comparison.py
â”‚   â”‚   â”œâ”€â”€ services/            # ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”‚   â”œâ”€â”€ collector.py
â”‚   â”‚   â”‚   â”œâ”€â”€ analyzer.py
â”‚   â”‚   â”‚   â”œâ”€â”€ ai_engine.py
â”‚   â”‚   â”‚   â””â”€â”€ report_gen.py
â”‚   â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â””â”€â”€ tasks.py             # Celery ä»»åŠ¡
â”‚   â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â””â”€â”€ requirements.txt
â”œâ”€â”€ frontend/                     # Web UIï¼ˆå¯é€‰ï¼‰
â”‚   â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ Dockerfile
â”œâ”€â”€ cli/                          # CLI å·¥å…·
â”‚   â”œâ”€â”€ main.py
â”‚   â””â”€â”€ commands/
â”œâ”€â”€ docs/                         # æ–‡æ¡£
â”‚   â”œâ”€â”€ ARCHITECTURE.md
â”‚   â”œâ”€â”€ API.md
â”‚   â””â”€â”€ DEPLOYMENT.md
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ .env.example
â””â”€â”€ README.md
```

### C. å‚è€ƒèµ„æº

**ç®—æ³•å’Œè®ºæ–‡**:
- [PELT: Pruned Exact Linear Time](https://arxiv.org/abs/1101.1438)
- [Time Series Change Point Detection](https://github.com/deepcharles/ruptures)
- [TF-IDF for Text Analysis](https://scikit-learn.org/stable/modules/feature_extraction.html)

**æŠ€æœ¯æ–‡æ¡£**:
- [FastAPI æ–‡æ¡£](https://fastapi.tiangolo.com/)
- [Celery æ–‡æ¡£](https://docs.celeryproject.org/)
- [browser-use æ–‡æ¡£](https://docs.browser-use.com/)
- [Gemini API æ–‡æ¡£](https://ai.google.dev/gemini-api/docs)

---

## æ€»ç»“

è¿™ä»½æŠ€æœ¯æ¶æ„æ–‡æ¡£æä¾›äº†"å°çº¢ä¹¦èµ·å·æµç¨‹åˆ†æå·¥å…·"çš„å®Œæ•´æŠ€æœ¯æ–¹æ¡ˆï¼ŒåŒ…æ‹¬ï¼š

1. âœ… **æ¸…æ™°çš„ç³»ç»Ÿæ¶æ„**: å››å±‚æ¶æ„ï¼ŒèŒè´£åˆ†æ˜
2. âœ… **æ ¸å¿ƒæ¨¡å—è®¾è®¡**: 6 å¤§æ¨¡å—ï¼ŒåŠŸèƒ½å®Œæ•´
3. âœ… **æ•°æ®æ¨¡å‹è®¾è®¡**: å®Œæ•´çš„æ•°æ®ç»“æ„å’Œæ•°æ®åº“è¡¨
4. âœ… **ç®—æ³•è®¾è®¡**: ç²‰ä¸æ¨ç®—ã€æ‹ç‚¹æ£€æµ‹ã€çˆ†æ¬¾è¯†åˆ«ç­‰æ ¸å¿ƒç®—æ³•
5. âœ… **API è®¾è®¡**: RESTful APIï¼Œæ¸…æ™°æ˜“ç”¨
6. âœ… **éƒ¨ç½²æ–¹æ¡ˆ**: Docker Compose ä¸€é”®éƒ¨ç½²
7. âœ… **å¼€å‘è·¯çº¿**: ä» MVP åˆ°å®Œæ•´äº§å“çš„è¿­ä»£è®¡åˆ’

**æŠ€æœ¯å¯è¡Œæ€§**: â­â­â­â­â­ï¼ˆå®Œå…¨å¯è¡Œï¼Œ80% ä»£ç å¯å¤ç”¨ï¼‰

**å•†ä¸šä»·å€¼**: â­â­â­â­â­ï¼ˆåˆšéœ€ï¼Œä»˜è´¹æ„æ„¿å¼ºï¼‰

**å¼€å‘å‘¨æœŸ**: 1-2å‘¨ MVPï¼Œ1ä¸ªæœˆå®Œæ•´ç‰ˆ

---

**ä¸‹ä¸€æ­¥å»ºè®®**:
1. åˆ›å»ºé¡¹ç›®ä»“åº“
2. æ­å»ºåŸºç¡€æ¡†æ¶
3. å®ç° MVP æ ¸å¿ƒåŠŸèƒ½
4. å°èŒƒå›´æµ‹è¯•
5. è¿­ä»£ä¼˜åŒ–
6. å…¬å¼€å‘å¸ƒ

éœ€è¦æˆ‘å¸®ä½ å¼€å§‹æ­å»ºé¡¹ç›®å—ï¼ŸğŸš€
